<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Luban Fragrance | The Essence of Elegance</title>
    <link rel="icon" type="image/png" href="https://i.ibb.co.com/Vcq9NZsL/Logo.png">
    <link rel="shortcut icon" type="image/png" href="https://i.ibb.co.com/Vcq9NZsL/Logo.png">
    <link rel="apple-touch-icon" href="https://i.ibb.co.com/Vcq9NZsL/Logo.png">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Inter:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            /* Luxury Color Palette */
            --bg-dark: #020606;
            --bg-accent: #080d0c;
            --gold-primary: #cba35c;
            --gold-bright: #e9c46a;
            --gold-muted: rgba(203, 163, 92, 0.4);
            --text-white: #f8f8f8;
            --text-dim: rgba(248, 248, 248, 0.7);
            --border-gold: rgba(203, 163, 92, 0.15);
            --border-white: rgba(255, 255, 255, 0.08);
            
            /* Motion & Easing */
            --transition-smooth: all 0.8s cubic-bezier(0.2, 1, 0.2, 1);
            --transition-fast: all 0.4s cubic-bezier(0.2, 1, 0.2, 1);
            --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
            --ease-luxury: cubic-bezier(0.3, 0, 0.2, 1);
            
            /* Sizing & Spacing */
            --nav-height: clamp(80px, 10vh, 110px);
            --container-padding: clamp(5%, 8vw, 12%);
            
            /* Shadows & Depth */
            --shadow-subtle: 0 10px 40px rgba(0,0,0,0.6);
            --shadow-medium: 0 20px 60px rgba(0,0,0,0.8);
            --shadow-gold: 0 0 30px rgba(203, 163, 92, 0.1);
            --shadow-glow: 0 15px 45px rgba(0, 0, 0, 0.7), 0 0 25px rgba(203, 163, 92, 0.15);
        }

        @media (max-width: 1200px) {
            :root { --container-padding: 8%; }
        }
        @media (max-width: 768px) {
            :root { --container-padding: 5%; }
            #hero h1 { letter-spacing: 0.1em; } 
            .hero-content p { letter-spacing: 5px !important; font-size: 0.75rem !important; margin-bottom: 2.5rem !important; }
            .filter-btn { padding: 8px 16px; font-size: 0.65rem; letter-spacing: 2px; flex: 1 1 auto; text-align: center; min-width: 100px; }
            .filter-container { gap: 8px; margin-bottom: 30px; padding: 0 10px; }
            .input, textarea, select { font-size: 16px; padding: 15px; }
            .btn-gold { padding: 16px 32px; letter-spacing: 3px; font-size: 0.65rem; }
        }
        @media (max-width: 480px) {
            :root { --container-padding: 4%; }
            .hero-content p { letter-spacing: 3px !important; font-size: 0.7rem !important; }
            .filter-btn { min-width: 80px; padding: 8px 12px; }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        html {
            scroll-behavior: smooth;
            /* Precise offset for sticky header navigation */
            scroll-padding-top: calc(var(--nav-height) + 20px);
            scrollbar-width: thin;
            scrollbar-color: var(--gold-primary) var(--bg-dark);
            overflow-x: hidden;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-white);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            line-height: 1.7;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            width: 100%;
        }

        /* View Entrance Animation - Makes switching feel premium */
        #main-view, #details-view, #checkout-view {
            animation: luxuryFadeIn 0.8s var(--ease-luxury) both;
            will-change: opacity, transform;
        }

        @keyframes luxuryFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Section Offsets for Sticky Header Alignment */
        #hero, #shop, #about, #contact, #details-view, #checkout-view {
            scroll-margin-top: var(--nav-height);
        }

        /* Desktop Custom Cursor - Refined and Minimal */
        @media (min-width: 1200px) {
            body:not(.no-cursor) * { cursor: none !important; }
            #custom-cursor {
                width: 12px;
                height: 12px;
                background: var(--gold-primary);
                border-radius: 50%;
                position: fixed;
                pointer-events: none;
                z-index: 9999;
                transition: transform 0.2s var(--ease-out-expo), opacity 0.3s ease;
                mix-blend-mode: normal;
                display: block;
                will-change: transform;
                transform: translate(-50%, -50%);
                box-shadow: 0 0 15px var(--gold-primary);
            }
            #custom-cursor::after {
                content: '';
                position: absolute;
                top: -12px; left: -12px;
                width: 36px; height: 36px;
                border: 1px solid var(--gold-muted);
                border-radius: 50%;
                transition: transform 0.3s var(--ease-out-expo);
            }
            .interactive:hover ~ #custom-cursor,
            .interactive:hover #custom-cursor {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0.8;
            }
            .interactive:hover ~ #custom-cursor::after,
            .interactive:hover #custom-cursor::after {
                transform: scale(1.5);
                border-color: var(--gold-primary);
            }
        }

        @media (max-width: 1199px) {
            #custom-cursor { display: none; }
        }

        /* Typography Refinement */
        h1, h2, h3, .playfair {
            font-family: 'Playfair Display', serif;
            font-weight: 400;
            letter-spacing: -0.01em;
            word-wrap: break-word;
        }

        h1 { letter-spacing: 0.25em; }
        h2 { letter-spacing: 0.15em; text-transform: uppercase; }

        p { font-weight: 300; letter-spacing: 0.02em; font-size: 0.95rem; opacity: 0.9; }

        /* Scroll Progress - Luxury Gold Gradient with Glow */
        #scroll-progress {
            position: fixed;
            top: 0; left: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--gold-primary), var(--gold-bright));
            z-index: 2001;
            width: 0%;
            transition: width 0.1s linear;
            box-shadow: 0 0 15px rgba(203, 163, 92, 0.6);
        }
        #scroll-progress::after {
            content: '';
            position: absolute;
            right: 0; top: 0;
            height: 100%; width: 20px;
            background: var(--gold-bright);
            filter: blur(4px);
            opacity: 0.8;
        }

        /* Scroll Indicator in Hero */
        .scroll-indicator {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            color: var(--gold-muted);
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 4px;
            animation: bounce 2s infinite;
            cursor: pointer;
            opacity: 0.6;
            transition: var(--transition-fast);
        }
        .scroll-indicator:hover { opacity: 1; color: var(--gold-primary); }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
            40% { transform: translateX(-50%) translateY(-10px); }
            60% { transform: translateX(-50%) translateY(-5px); }
        }
        .scroll-line {
            width: 1px;
            height: 40px;
            background: linear-gradient(to bottom, var(--gold-muted), transparent);
        }

        /* Navigation - Glassmorphism & Elevation */
        nav {
            position: fixed;
            top: 0; width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: env(safe-area-inset-top) var(--container-padding) 0;
            height: calc(var(--nav-height) + env(safe-area-inset-top));
            z-index: 1000;
            transition: var(--transition-smooth);
            background: transparent;
        }

        nav.scrolled {
            height: calc(clamp(70px, 8vh, 90px) + env(safe-area-inset-top));
            padding-top: env(safe-area-inset-top);
            background: rgba(2, 6, 6, 0.85);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-bottom: 1px solid var(--border-gold);
            box-shadow: var(--shadow-subtle);
        }

        @media (max-width: 768px) {
            nav.scrolled { height: calc(clamp(60px, 7vh, 70px) + env(safe-area-inset-top)); }
        }

        .nav-logo-img {
            height: 60px;
            width: auto;
            transition: var(--transition-smooth);
            filter: drop-shadow(0 4px 10px rgba(0,0,0,0.4));
        }
        nav.scrolled .nav-logo-img { height: 48px; }
        @media (max-width: 768px) {
            .nav-logo-img { height: 45px; }
            nav.scrolled .nav-logo-img { height: 38px; }
        }

        .nav-links {
            display: flex;
            gap: 3.5rem;
            list-style: none;
            flex: 1;
            justify-content: center;
        }
        .nav-links a {
            text-decoration: none;
            color: var(--text-dim);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 4px;
            transition: var(--transition-fast);
            position: relative;
            padding: 10px 0;
        }
        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0; left: 50%;
            width: 0%; height: 1px;
            background: var(--gold-primary);
            transition: var(--transition-fast);
            transform: translateX(-50%);
        }
        .nav-links a:hover { color: var(--gold-primary); }
        .nav-links a:hover::after { width: 40%; }

        .nav-actions { display: flex; align-items: center; gap: 2.5rem; }
        .social-icons-nav { display: flex; gap: 1.5rem; border-right: 1px solid var(--border-gold); padding-right: 2.5rem; }
        .social-link { color: var(--gold-muted); transition: var(--transition-fast); }
        .social-link:hover { color: var(--gold-primary); transform: translateY(-3px); }

        .cart-trigger {
            position: relative;
            transition: var(--transition-fast);
            padding: 10px;
            border-radius: 50%;
        }
        .cart-trigger:hover { background: rgba(203, 163, 92, 0.12); transform: scale(1.05); }
        #cart-count {
            position: absolute;
            top: 2px; right: 2px;
            background: var(--gold-primary);
            color: var(--bg-dark);
            font-size: 9px;
            font-weight: 800;
            width: 16px; height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--gold-primary);
            padding: 10px;
            transition: var(--transition-fast);
        }

        /* Hero - Cinematic Entrance */
        #hero {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            text-align: center;
            padding: 0 var(--container-padding);
            padding-top: 180px;
            padding-bottom: 60px;
        }

        @media (max-width: 768px) {
            #hero { padding-top: 120px; }
        }

        .hero-bg-text {
            position: absolute;
            top: 48%;
            left: 0;
            width: 100%;
            font-size: 28vw;
            font-family: 'Playfair Display';
            color: rgba(203, 163, 92, 0.025);
            white-space: nowrap;
            pointer-events: none;
            z-index: 0;
            will-change: transform;
            line-height: 0.8;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            width: 100%;
        }

        .hero-content img {
            opacity: 0;
            animation: revealSimple 1.5s var(--transition-smooth) forwards 0.3s;
        }

        #hero h1 {
            font-size: clamp(3rem, 12vw, 10rem);
            font-weight: 500;
            margin-bottom: 2rem;
            background: linear-gradient(180deg, #FFFFFF 10%, #cba35c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            opacity: 0;
            will-change: transform, opacity, filter, letter-spacing;
            /* Premium Sophisticated Reveal */
            animation: revealTitle 2.8s var(--ease-luxury) forwards 0.6s;
            max-width: 100%;
        }

        .hero-content p {
            opacity: 0;
            animation: revealSimple 1.8s var(--transition-smooth) forwards 1s;
            max-width: 100%;
            overflow-wrap: break-word;
        }

        .hero-content .btn-gold {
            opacity: 0;
            animation: revealSimple 1.5s var(--transition-smooth) forwards 1.4s;
        }

        @keyframes revealTitle {
            0% { 
                opacity: 0; 
                /* More subtle movement and scale for premium feel */
                transform: translateY(15px) scale(1.02); 
                filter: blur(12px);
                letter-spacing: 0.4em;
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
                filter: blur(0);
                letter-spacing: 0.25em;
            }
        }

        @keyframes revealSimple {
            0% { opacity: 0; transform: translateY(15px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* Luxury Buttons */
        .btn-gold {
            background: transparent;
            border: 1px solid var(--gold-primary);
            color: var(--gold-primary);
            padding: 20px 48px;
            text-transform: uppercase;
            letter-spacing: 5px;
            font-size: 0.7rem;
            font-weight: 500;
            transition: var(--transition-smooth);
            border-radius: 1px;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        @media (max-width: 768px) {
            .btn-gold { padding: 18px 36px; letter-spacing: 3px; }
        }
        .btn-gold::before {
            content: '';
            position: absolute;
            top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: 0.6s;
            z-index: -1;
        }
        .btn-gold:hover { color: var(--bg-dark); background: var(--gold-primary); border-color: var(--gold-primary); letter-spacing: 6px; }
        .btn-gold:hover::before { left: 100%; }

        /* Product Library */
        #shop { padding: clamp(60px, 10vh, 120px) var(--container-padding); background: var(--bg-accent); position: relative; }
        #shop::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 200px;
            background: linear-gradient(180deg, var(--bg-dark) 0%, transparent 100%);
        }
        .product-grid { 
            display: grid; 
            gap: clamp(20px, 4vw, 50px); 
            grid-template-columns: repeat(auto-fill, minmax(clamp(250px, 20vw, 320px), 1fr));
        }

        @media (max-width: 600px) {
            .product-grid { 
                grid-template-columns: 1fr;
                gap: 30px;
            }
            .product-card { padding: 20px; }
        }

        .product-card {
            background: rgba(255,255,255,0.015);
            border: 1px solid var(--border-gold);
            padding: clamp(30px, 5vw, 55px);
            transition: 
                transform 0.8s var(--ease-luxury), 
                border-color 0.8s var(--ease-luxury), 
                box-shadow 0.8s var(--ease-luxury), 
                background 0.8s var(--ease-luxury);
            display: flex;
            flex-direction: column;
            border-radius: 2px;
            position: relative;
            overflow: hidden;
            will-change: transform, box-shadow, border-color;
            /* Defined timeline for scroll parallax */
            view-timeline: --card-view block;
        }
        
        .product-card:hover {
            transform: translateY(-12px);
            background: rgba(255,255,255,0.035);
            border-color: var(--gold-primary);
            box-shadow: 0 20px 50px rgba(0,0,0,0.7), 0 0 25px rgba(203, 163, 92, 0.4);
        }

        .image-container {
            aspect-ratio: 1/1;
            overflow: hidden;
            background: radial-gradient(circle, rgba(203,163,92,0.08) 0%, rgba(0,0,0,0.1) 100%);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255,255,255,0.03);
            transition: background 0.5s ease;
        }
        
        .image-container img {
            width: 80%; height: 80%;
            object-fit: contain;
            transition: transform 0.8s var(--ease-luxury), opacity 0.5s ease;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5));
            will-change: transform;
        }

        .parallax-wrapper {
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            animation: luxuryParallax linear both;
            animation-timeline: --card-view;
            animation-range: entry 0% exit 100%;
            will-change: transform;
        }
        
        @keyframes luxuryParallax {
            0% { transform: translateY(-10px); }
            100% { transform: translateY(10px); }
        }

        .product-card:hover .image-container img { 
            transform: scale(1.1);
        }

        .wishlist-btn {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(2, 6, 6, 0.85);
            border: 1px solid var(--gold-primary);
            width: 52px;
            height: 52px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 25px rgba(0,0,0,0.6);
            color: var(--text-dim);
        }
        
        .wishlist-btn svg {
            transition: all 0.3s ease;
            fill: none;
            stroke-width: 1.5px;
        }

        /* Hover State (General) */
        .wishlist-btn:hover {
            transform: scale(1.1);
            color: var(--gold-bright);
            border-color: var(--gold-bright);
            box-shadow: 0 0 20px rgba(233, 196, 106, 0.2);
        }

        /* Active State (Wishlisted) */
        .wishlist-btn.active {
            color: var(--gold-primary);
            border-color: var(--gold-primary);
        }
        
        .wishlist-btn.active svg {
            fill: currentColor; /* Filled Gold Heart */
            stroke: none;
        }
        
        /* Active + Hover */
        .wishlist-btn.active:hover {
            color: var(--gold-bright);
            border-color: var(--gold-bright);
        }
        
        /* Tooltip Styles (Preserved) */
        .wishlist-tooltip {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            background: rgba(0, 0, 0, 0.9);
            color: var(--gold-primary);
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.7rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            pointer-events: none;
            border: 1px solid var(--border-gold);
            z-index: 20;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        .wishlist-btn:hover .wishlist-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }
        .wishlist-btn:not(.active):hover svg {
            fill: none;
        }

        .wishlist-btn:active {
            transform: scale(0.9);
        }

        /* Product Info Typography */
        .product-info {
            margin-top: 20px;
        }
        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            gap: 20px;
        }
        .product-name {
            font-size: 1.6rem;
            text-transform: uppercase;
            letter-spacing: 4px;
            font-weight: 500;
            line-height: 1.2;
            flex: 1;
            color: var(--text-white);
            transition: color 0.3s ease;
        }
        .product-card:hover .product-name {
            color: var(--gold-primary);
        }
        .product-price {
            color: var(--gold-primary);
            font-weight: 700;
            font-size: 1.2rem;
            white-space: nowrap;
            margin-top: 5px;
        }
        .product-desc {
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 3px;
            line-height: 1.8;
            opacity: 0.7;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Fluid Grids for Sections */
        .about-grid, .contact-grid {
            display: grid;
            gap: clamp(40px, 8vw, 100px);
            align-items: start;
        }
        @media (max-width: 1024px) {
            .about-grid, .contact-grid { gap: 50px; grid-template-columns: 1fr !important; }
        }
        @media (max-width: 768px) {
            .about-grid, .contact-grid { gap: 40px; }
        }

        /* Detail View Upgrade */
        #details-view { background: var(--bg-dark); }
        /* Target injected detail structure */
        #details-content > div {
            display: grid !important;
            grid-template-columns: 1fr 1fr;
            gap: 100px;
            align-items: center;
        }
        @media (max-width: 1024px) {
            #details-content > div { grid-template-columns: 1fr !important; gap: 50px !important; }
            #details-view { padding-top: 140px !important; }
        }

        .size-btn {
            padding: 14px 28px;
            border: 1px solid var(--border-gold);
            background: transparent;
            color: var(--text-dim);
            font-size: 0.75rem;
            letter-spacing: 3px;
            text-transform: uppercase;
            transition: var(--transition-fast);
            flex: 1;
            border-radius: 1px;
        }
        @media (max-width: 480px) {
            .size-btn { padding: 12px 15px; font-size: 0.65rem; letter-spacing: 1px; }
        }
        .size-btn.active { background: var(--gold-primary); color: var(--bg-dark); font-weight: 700; border-color: var(--gold-primary); transform: scale(1.02); }
        .size-btn:hover:not(.active) { border-color: var(--gold-primary); color: var(--gold-primary); background: rgba(203, 163, 92, 0.05); }

        /* Forms & Inputs */
        .checkout-panel {
            background: var(--bg-accent);
            border: 1px solid var(--border-gold);
            padding: clamp(20px, 5vw, 40px);
            border-radius: 2px;
            transition: var(--transition-smooth);
        }
        
        .checkout-panel:hover {
            border-color: var(--gold-primary);
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
        }

        .checkout-grid {
            display: grid;
            gap: clamp(30px, 6vw, 60px);
            align-items: start;
            grid-template-columns: minmax(350px, 480px) 1fr;
        }

        .checkout-input-group {
            position: relative;
            margin-bottom: 5px;
        }

        .checkout-input-group label {
            position: absolute;
            top: -10px;
            left: 15px;
            background: #050a09; /* Perfectly matches the section container background for a seamless luxury look */
            padding: 0 10px;
            font-size: 0.65rem;
            color: var(--gold-primary);
            text-transform: uppercase;
            letter-spacing: 2px;
            z-index: 1;
            pointer-events: none;
            transition: var(--transition-fast);
            font-weight: 600;
        }

        .checkout-input-group input:focus + label,
        .checkout-input-group select:focus + label {
            color: var(--gold-bright);
            transform: translateY(-2px);
            background: var(--bg-dark);
        }

        .checkout-section-container {
            background: rgba(255, 255, 255, 0.01);
            border: 1px solid rgba(203, 163, 92, 0.05);
            padding: 30px;
            border-radius: 4px;
            transition: var(--transition-smooth);
        }

        .checkout-section-container:hover {
            background: rgba(255, 255, 255, 0.02);
            border-color: rgba(203, 163, 92, 0.15);
        }

        .checkout-item-row {
            display: flex;
            gap: 20px;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(203, 163, 92, 0.1);
            transition: var(--transition-fast);
        }

        .checkout-item-row:hover {
            background: rgba(255, 255, 255, 0.03);
            padding-left: 10px;
            padding-right: 10px;
            margin-left: -10px;
            margin-right: -10px;
            border-radius: 4px;
        }

        .checkout-summary-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        .checkout-total-line {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid var(--gold-primary);
        }

        @media (max-width: 1024px) {
            .checkout-grid { grid-template-columns: 1fr !important; }
            .checkout-grid aside { order: 1; }
            .checkout-grid .checkout-panel { order: 2; }
        }

        /* Form Validation Styles */
        .input:invalid:not(:placeholder-shown) {
            border-color: #ff4d4d;
        }
        .input:valid:not(:placeholder-shown) {
            border-color: #4dff4d;
        }

        /* Custom Scrollbar for Checkout Items */
        #checkout-items::-webkit-scrollbar { width: 4px; }
        #checkout-items::-webkit-scrollbar-track { background: rgba(255,255,255,0.02); }
        #checkout-items::-webkit-scrollbar-thumb { background: var(--gold-muted); border-radius: 10px; }
        #checkout-items::-webkit-scrollbar-thumb:hover { background: var(--gold-primary); }

        /* Animation for checkout entrance */
        @keyframes checkoutEntrance {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #checkout-view > div {
            animation: checkoutEntrance 0.8s var(--ease-luxury) both;
        }
        .input, textarea, select {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-white);
            color: var(--text-white);
            padding: 18px;
            font-size: 0.9rem;
            transition: var(--transition-fast);
            border-radius: 1px;
            width: 100%;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }
        select {
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23cba35c' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 18px center;
            background-size: 16px;
            padding-right: 50px !important;
            cursor: pointer;
        }
        select option {
            background-color: var(--bg-dark);
            color: var(--text-white);
            padding: 15px;
        }
        /* Refined Premium Focus State */
        .input:focus, textarea:focus, select:focus { 
            border-color: var(--gold-bright); 
            background: rgba(203, 163, 92, 0.08); 
            /* Multi-layered shadow for high-end depth and a tactile lift effect */
            box-shadow: 
                0 15px 35px rgba(0, 0, 0, 0.6), 
                0 0 0 1px var(--gold-bright), 
                0 0 20px rgba(203, 163, 92, 0.15); 
            transform: translateY(-3px);
            outline: none;
        }

        /* Cart & Menu Overlays - Sophisticated Motion */
        #cart-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(0px);
            -webkit-backdrop-filter: blur(0px);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.8s var(--ease-out-expo), backdrop-filter 0.8s var(--ease-out-expo), visibility 0.8s;
        }
        #cart-overlay.open { 
            opacity: 1; 
            visibility: visible; 
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        
        .cart-drawer {
            position: fixed;
            top: 0; right: -100%;
            width: 100%; max-width: 520px;
            height: 100%;
            background: var(--bg-dark);
            border-left: 1px solid var(--border-gold);
            padding: clamp(30px, 5vw, 60px);
            transition: right 0.8s var(--ease-out-expo);
            display: flex; flex-direction: column;
            box-shadow: -20px 0 60px rgba(0,0,0,0.8);
            z-index: 2001;
            padding-bottom: calc(30px + env(safe-area-inset-bottom));
        }
        /* Sophisticated Internal Materialization */
        .cart-drawer > * {
            opacity: 0;
            transform: translateX(40px);
            transition: opacity 1s var(--ease-out-expo) 0.1s, transform 1s var(--ease-out-expo) 0.1s;
        }
        #cart-overlay.open .cart-drawer { right: 0; }
        #cart-overlay.open .cart-drawer > * { opacity: 1; transform: translateX(0); }

        /* Cart Item Specific Animation - Slide-in from the right with fade-in */
        .cart-item {
            animation: cartItemAppear 0.8s var(--ease-out-expo) both;
            will-change: transform, opacity;
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
            padding: 15px;
            border: 1px solid transparent;
            border-bottom: 1px solid var(--border-gold);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 4px;
            cursor: pointer;
        }
        .cart-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--gold-primary);
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        @keyframes cartItemAppear {
            0% { 
                opacity: 0; 
                transform: translateX(30px); 
            }
            100% { 
                opacity: 1; 
                transform: translateX(0); 
            }
        }

        @media (max-width: 767px) {
            .cart-drawer {
                top: auto; bottom: -100%; right: 0;
                height: 85vh; max-width: 100%;
                border-left: none; border-top: 1px solid var(--border-gold);
                transition: bottom 0.8s var(--ease-out-expo);
                padding: 30px 20px calc(20px + env(safe-area-inset-bottom));
            }
            #cart-overlay.open .cart-drawer { bottom: 0; right: 0; }
            .cart-drawer > * { transform: translateY(40px) translateX(0); }
            #cart-overlay.open .cart-drawer > * { transform: translateY(0); }
        }

        /* Mobile Menu Refined Animation - Scale & Fade Reveal */
        #mobile-menu {
            position: fixed; inset: 0; background: var(--bg-dark); z-index: 1001;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            gap: 3rem; 
            transform: scale(0.92); 
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: transform 0.8s var(--ease-out-expo), opacity 0.8s var(--ease-out-expo), visibility 0.8s;
            padding: 0 20px;
        }
        #mobile-menu.active { 
            transform: scale(1); 
            opacity: 1; 
            visibility: visible;
            pointer-events: auto;
        }
        
        /* Refined entrance for each mobile-link */
        .mobile-link { 
            font-family: 'Playfair Display'; font-size: clamp(2rem, 8vw, 2.8rem); color: var(--gold-primary); 
            letter-spacing: 5px; text-decoration: none; 
            text-align: center;
            will-change: transform, opacity, filter;
            opacity: 0;
            /* Precise refined lift and pronounced fade timing as requested */
            transform: translateY(20px);
            transition: 
                opacity 0.8s var(--ease-out-expo), 
                transform 0.8s var(--ease-out-expo);
            /* Sequential transition-delay logic based on index */
            transition-delay: calc(0.1s + (0.08s * var(--i))); 
        }
        
        #mobile-menu.active .mobile-link { 
            opacity: 1; 
            transform: translateY(0); 
        }

        /* Micro-interactions (Floaters) */
        #back-to-top, #whatsapp-float {
            position: fixed;
            right: 40px;
            width: 60px; height: 60px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            z-index: 100;
            transition: var(--transition-smooth);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-gold);
            cursor: pointer;
        }
        @media (max-width: 768px) {
            #back-to-top, #whatsapp-float { right: 20px; width: 50px; height: 50px; }
            #whatsapp-float { bottom: 90px; }
            #back-to-top { bottom: 25px; }
        }
        #back-to-top { bottom: 40px; background: rgba(203, 163, 92, 0.1); color: var(--gold-primary); opacity: 0; visibility: hidden; }
        #back-to-top.visible { opacity: 1; visibility: visible; }
        #whatsapp-float { bottom: 120px; background: rgba(37, 211, 102, 0.1); border-color: rgba(37, 211, 102, 0.2); color: #25D366; }
        
        #back-to-top:hover { transform: translateY(-10px); background: var(--gold-primary); color: var(--bg-dark); border-color: var(--gold-primary); }
        #whatsapp-float:hover { transform: translateY(-10px); background: #25D366; color: white; border-color: #25D366; }

        /* Quantity UI - Tactical Feel */
        .qty-controls { display: flex; align-items: center; gap: 20px; background: rgba(255,255,255,0.03); padding: 8px 20px; border-radius: 1px; border: 1px solid var(--border-white); }
        .qty-btn { background: none; border: none; color: var(--gold-primary); cursor: pointer; display: flex; align-items: center; padding: 5px; transition: var(--transition-fast); }
        .qty-btn:hover { color: var(--text-white); transform: scale(1.3); }

        /* Filter Buttons & Categories */
        .filter-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .filter-group-label {
            width: 100%;
            text-align: center;
            font-size: 0.6rem;
            color: var(--gold-muted);
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 10px;
        }
        .filter-btn {
            background: transparent;
            border: 1px solid var(--border-gold);
            color: var(--text-dim);
            padding: 10px 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 0.65rem;
            cursor: pointer;
            transition: var(--transition-fast);
            border-radius: 1px;
        }
        .filter-btn:hover {
            border-color: var(--gold-primary);
            color: var(--gold-primary);
        }
        .filter-btn.active {
            background: var(--gold-primary);
            color: var(--bg-dark);
            border-color: var(--gold-primary);
            font-weight: 600;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 40px;
            transition: opacity 0.4s ease, transform 0.4s ease;
        }
        .product-grid.filtering {
            opacity: 0;
            transform: translateY(10px);
        }

        /* Mobile Menu Search & Sub-menu Refinements */
        .mobile-search-container {
            width: 100%;
            max-width: 300px;
            margin-bottom: 1rem;
            position: relative;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s var(--ease-out-expo) 0.05s;
        }
        #mobile-menu.active .mobile-search-container {
            opacity: 1;
            transform: translateY(0);
        }

        #mobile-recent-section {
            width: 100%;
            margin-top: 20px;
            padding: 0 20px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s var(--ease-out-expo) 0.3s;
        }
        #mobile-menu.active #mobile-recent-section {
            opacity: 1;
            transform: translateY(0);
        }
        #mobile-recent-list::-webkit-scrollbar {
            display: none;
        }
        #mobile-recent-list {
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }
        .mobile-search-input {
            width: 100%;
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border-gold);
            padding: 15px 45px 15px 20px;
            color: var(--text-white);
            font-size: 0.9rem;
            border-radius: 1px;
            letter-spacing: 1px;
        }
        .mobile-search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gold-primary);
            pointer-events: none;
        }
        .mobile-submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s var(--ease-luxury);
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 0;
            opacity: 0;
        }
        .mobile-submenu.active {
            max-height: 300px;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            opacity: 1;
        }
        .mobile-sublink {
            font-size: 1rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 3px;
            text-decoration: none;
            transition: var(--transition-fast);
            text-align: center;
        }
        .mobile-sublink:hover { color: var(--gold-primary); }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-dark);
            border: 1px solid var(--border-gold);
            border-top: none;
            z-index: 10;
            max-height: 250px;
            overflow-y: auto;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .search-suggestions.active { display: block; }
        .suggestion-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: var(--transition-fast);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 0.85rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .suggestion-item:hover {
            background: rgba(203, 163, 92, 0.1);
            color: var(--gold-primary);
        }
        .suggestion-item:last-child { border-bottom: none; }

        /* Shimmer/Skeleton Loading States */
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.03) 25%, rgba(255,255,255,0.08) 50%, rgba(255,255,255,0.03) 75%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite linear;
            border-radius: 2px;
        }
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .skeleton-card {
            padding: 30px;
            border: 1px solid var(--border-gold);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .skeleton-img { aspect-ratio: 1/1; width: 100%; }
        .skeleton-title { height: 24px; width: 60%; }
        .skeleton-text { height: 14px; width: 100%; }
        .skeleton-price { height: 20px; width: 30%; }

        /* Accessibility */
        :focus-visible { outline: 2px solid var(--gold-primary); outline-offset: 4px; }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }

        /* Confirmation & Review Modals */
        .confirm-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: flex; align-items: center; justify-content: center;
            z-index: 3000; opacity: 0; visibility: hidden;
            transition: all 0.5s var(--ease-luxury);
            backdrop-filter: blur(10px);
            padding: 20px;
        }
        .confirm-overlay.show { opacity: 1; visibility: visible; }
        .confirm-box {
            background: var(--bg-accent);
            padding: clamp(30px, 5vw, 50px);
            text-align: center;
            max-width: 600px;
            width: 100%;
            border: 1px solid var(--border-gold);
            box-shadow: var(--shadow-glow);
            transform: translateY(20px);
            transition: transform 0.5s var(--ease-luxury);
            border-radius: 1px;
        }
        .confirm-overlay.show .confirm-box { transform: translateY(0); }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(2, 6, 6, 0.95);
            border: 1px solid var(--gold-primary);
            color: var(--gold-primary);
            padding: 16px 32px;
            border-radius: 2px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            z-index: 4000;
            opacity: 0;
            transition: all 0.6s var(--ease-out-expo);
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            pointer-events: none;
        }
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Wishlist Animations */
        @keyframes heartPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.4); }
            100% { transform: scale(1); }
        }
        
        .animate-pop {
            animation: heartPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #wishlist-count-desktop { overflow: hidden !important; }
        .wishlist-number {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1), opacity 0.3s ease;
            will-change: transform, opacity;
            font-size: 9px;
            font-weight: 800;
        }
        
        /* Hide number input arrows */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; 
          margin: 0; 
        }
        input[type=number] {
          -moz-appearance: textfield;
        }

        /* Mob Menu Refinement */
        @media (max-width: 1024px) {
            nav { padding: 0 var(--container-padding); }
            .nav-links, .social-icons-nav { display: none; }
            .menu-toggle { display: block; }
        }

    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body>

    <a class="sr-only" href="#main-view">Skip to main content</a>

    <div id="custom-cursor" aria-hidden="true"></div>
    <div id="scroll-progress" role="progressbar" aria-hidden="true"></div>

    <div id="sr-announces" class="sr-only" aria-live="polite" aria-atomic="true"></div>
    
    <div id="toast-notification" class="toast">
        <i data-lucide="check" size="18"></i>
        <span>Item added to wishlist</span>
    </div>

    <div id="mobile-menu" aria-hidden="true">
        <button onclick="toggleMobileMenu()" aria-label="Close menu" style="position:absolute; top:30px; right:30px; background:none; border:none; color:var(--gold-primary);"><i data-lucide="x" size="36"></i></button>
        
        <div class="mobile-search-container">
            <input type="text" id="mobile-search" class="mobile-search-input" placeholder="Search our collection..." onkeyup="if(event.key === 'Enter') handleMobileSearch()" oninput="handleSearchInput(this.value)">
            <i data-lucide="search" class="mobile-search-icon" size="18"></i>
            <div id="search-suggestions" class="search-suggestions"></div>
            <div id="search-history-container" style="margin-top: 15px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;"></div>
        </div>

        <div style="width: 100%; overflow-y: auto; display: flex; flex-direction: column; align-items: center; gap: 2rem; padding: 20px 0;">
            <a href="javascript:void(0)" style="--i:1" class="mobile-link interactive" onclick="handleNavClick('hero'); toggleMobileMenu();">The Scent</a>
            
            <div style="display:flex; flex-direction:column; align-items:center; width: 100%;">
                <a href="javascript:void(0)" style="--i:2" class="mobile-link interactive" onclick="toggleSubmenu('collection-submenu')">Collection <i data-lucide="chevron-down" id="submenu-icon" size="20" style="vertical-align:middle; margin-left:5px; transition: transform 0.4s ease;"></i></a>
                <div id="collection-submenu" class="mobile-submenu">
                    <a href="javascript:void(0)" class="mobile-sublink" onclick="setFilter('All'); handleNavClick('shop'); toggleMobileMenu();">All Masterpieces</a>
                    <a href="javascript:void(0)" class="mobile-sublink" onclick="setFilter('Masculine'); handleNavClick('shop'); toggleMobileMenu();">Masculine</a>
                    <a href="javascript:void(0)" class="mobile-sublink" onclick="setFilter('Feminine'); handleNavClick('shop'); toggleMobileMenu();">Feminine</a>
                    <a href="javascript:void(0)" class="mobile-sublink" onclick="setFilter('Unisex'); handleNavClick('shop'); toggleMobileMenu();">Unisex</a>
                    <a href="javascript:void(0)" class="mobile-sublink" onclick="showWishlist(); toggleMobileMenu();" style="color:var(--gold-primary); font-weight:700;">My Wishlist (<span id="wishlist-count-mobile">0</span>)</a>
                </div>
            </div>

            <a href="javascript:void(0)" style="--i:3" class="mobile-link interactive" onclick="handleNavClick('about'); toggleMobileMenu();">Heritage</a>
            <a href="javascript:void(0)" style="--i:4" class="mobile-link interactive" onclick="handleNavClick('contact'); toggleMobileMenu();">Contact</a>

            <!-- Recently Viewed in Mobile Menu -->
            <div id="mobile-recent-section">
                <h4 style="font-size: 0.65rem; color: var(--gold-muted); text-transform: uppercase; letter-spacing: 3px; margin-bottom: 15px; text-align: center;">Recently Viewed</h4>
                <div id="mobile-recent-list" style="display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; -ms-overflow-style: none;">
                    <!-- Items injected via JS -->
                </div>
            </div>
            
            <div style="display:flex; gap: 40px; margin-top: 20px;">
                <a href="https://www.facebook.com/people/Luban-Fragrance/61586484638332/" target="_blank" rel="noopener noreferrer" style="color:var(--gold-primary);" class="interactive" aria-label="Facebook"><i data-lucide="facebook" size="32"></i></a>
                <a href="https://www.instagram.com/lubanfragrance" target="_blank" rel="noopener noreferrer" style="color:var(--gold-primary);" class="interactive" aria-label="Instagram"><i data-lucide="instagram" size="32"></i></a>
            </div>
        </div>
    </div>

    <div id="back-to-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" role="button" aria-label="Back to top" class="interactive"><i data-lucide="arrow-up" size="24"></i></div>
    <a id="whatsapp-float" href="https://wa.me/8801935322213?text=Hello%2C%20I'm%20interested%20in%20Luban%20Fragrance!" target="_blank" rel="noopener noreferrer" aria-label="Whatsapp contact" class="interactive">
        <i data-lucide="message-circle" size="24"></i>
    </a>

    <nav id="navbar">
        <div onclick="showView('main')" class="nav-logo-container interactive" style="cursor:pointer" role="button" aria-label="Go to homepage">
            <img src="https://i.ibb.co.com/Vcq9NZsL/Logo.png" alt="Luban Logo" class="nav-logo-img">
        </div>
        
        <ul class="nav-links">
            <li><a href="javascript:void(0)" onclick="handleNavClick('hero')" class="interactive">The Scent</a></li>
            <li><a href="javascript:void(0)" onclick="handleNavClick('shop')" class="interactive">Collection</a></li>
            <li><a href="javascript:void(0)" onclick="handleNavClick('about')" class="interactive">Heritage</a></li>
            <li><a href="javascript:void(0)" onclick="handleNavClick('contact')" class="interactive">Contact</a></li>
        </ul>

        <div class="nav-actions">
            <div class="social-icons-nav">
                <a href="https://www.facebook.com/people/Luban-Fragrance/61586484638332/" target="_blank" rel="noopener noreferrer" class="social-link interactive" aria-label="Facebook"><i data-lucide="facebook" size="18"></i></a>
                <a href="https://www.instagram.com/lubanfragrance" target="_blank" rel="noopener noreferrer" class="social-link interactive" aria-label="Instagram"><i data-lucide="instagram" size="18"></i></a>
            </div>
            <div class="wishlist-trigger interactive" onclick="showWishlist()" role="button" aria-label="Open wishlist" style="position: relative; margin-right: 1.5rem; cursor: pointer;">
                <i data-lucide="heart" stroke="#cba35c" size="22"></i>
                <span id="wishlist-count-desktop" style="position: absolute; top: -5px; right: -8px; background: var(--gold-primary); color: var(--bg-dark); font-size: 9px; font-weight: 800; width: 16px; height: 16px; display: none; align-items: center; justify-content: center; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.5);"></span>
            </div>
            <div class="cart-trigger interactive" onclick="toggleCart(true)" role="button" aria-label="Open cart">
                <i data-lucide="shopping-bag" stroke="#cba35c" size="22"></i>
                <span id="cart-count">0</span>
            </div>
            <button class="menu-toggle interactive" onclick="toggleMobileMenu()" aria-label="Open Menu"><i data-lucide="menu" size="32"></i></button>
        </div>
    </nav>

    <div id="main-view">
        <section id="hero">
            <div class="hero-bg-text" aria-hidden="true">LUBAN</div>
            <div class="hero-content">
                <img src="https://i.ibb.co.com/Vcq9NZsL/Logo.png" alt="Luban Emblem" style="width: clamp(60px, 15vw, 100px); margin-bottom: clamp(2rem, 5vh, 3.5rem); opacity: 0.9; filter: drop-shadow(0 4px 15px rgba(203,163,92,0.2));">
                <h1>LUBAN</h1>
                <p style="letter-spacing: clamp(5px, 2vw, 15px); color: var(--gold-muted); text-transform: uppercase; font-size: clamp(0.65rem, 1.5vw, 0.8rem); margin-bottom: clamp(2.5rem, 6vh, 4.5rem); font-weight: 500;">Refined Quality In Every Drop</p>
                <button class="btn-gold interactive" onclick="handleNavClick('shop')">Explore Collection</button>
            </div>
            <div class="scroll-indicator" onclick="handleNavClick('shop')">
                <span>Scroll</span>
                <div class="scroll-line"></div>
            </div>
        </section>

        <section id="shop">
            <div style="text-align: center; margin-bottom: clamp(40px, 8vh, 80px);">
                <h2 style="font-size: clamp(2rem, 5vw, 4.5rem); margin-bottom: 15px; color: var(--gold-primary); letter-spacing: clamp(6px, 2vw, 12px);">The Library</h2>
                <div style="width: 60px; height: 1px; background: var(--gold-primary); margin: 0 auto 15px;"></div>
                <p style="color: var(--text-dim); letter-spacing: clamp(3px, 1vw, 5px); text-transform: uppercase; font-size: clamp(0.6rem, 1.2vw, 0.7rem);">Selected Olfactory Masterpieces</p>
            </div>
            
            <div class="filter-container" style="margin-bottom: 60px;">
                <div class="filter-group-label">Gender Profile</div>
                <button class="filter-btn active interactive" data-filter="All" onclick="setFilter('All')">All</button>
                <button class="filter-btn interactive" data-filter="Masculine" onclick="setFilter('Masculine')">Masculine</button>
                <button class="filter-btn interactive" data-filter="Feminine" onclick="setFilter('Feminine')">Feminine</button>
                <button class="filter-btn interactive" data-filter="Unisex" onclick="setFilter('Unisex')">Unisex</button>
            </div>

            <div id="wishlist-controls" style="display:none; justify-content:center; margin-bottom: 40px; animation: luxuryFadeIn 0.5s ease;">
                 <button onclick="confirmEmptyWishlist()" class="filter-btn interactive" style="border-color: var(--gold-primary); color: var(--gold-primary); display: flex; align-items: center; gap: 10px;">
                    <i data-lucide="trash-2" size="14"></i> Empty Wishlist
                 </button>
            </div>

            <div class="product-grid" id="product-list"></div>
        </section>

        <section id="about" style="padding: clamp(60px, 10vh, 120px) var(--container-padding); background: var(--bg-dark); border-top: 1px solid var(--border-gold);">
            <div class="about-grid" style="grid-template-columns: 1fr 1.2fr;">
                <div style="position: relative; width: 100%;">
                    <div style="border: 1px solid var(--border-gold); padding: clamp(40px, 8vw, 100px); background: rgba(255,255,255,0.01); display: flex; justify-content: center; border-radius: 2px; position:relative;">
                        <img src="https://i.ibb.co.com/Vcq9NZsL/Logo.png" alt="Luban Logo Watermark" style="width: 70%; opacity: 0.12; filter: grayscale(1);">
                        <div style="position:absolute; bottom: -15px; right: -15px; width: clamp(60px, 10vw, 100px); height: clamp(60px, 10vw, 100px); border: 1px solid var(--gold-muted); opacity:0.3;"></div>
                    </div>
                </div>
                <div>
                    <h2 style="font-size: clamp(2rem, 6vw, 4.5rem); color: var(--gold-primary); margin-bottom: clamp(20px, 4vh, 30px); letter-spacing: clamp(3px, 1vw, 5px);">Our Heritage</h2>
                    <p style="color: var(--text-dim); line-height: 2; font-size: clamp(1rem, 2vw, 1.15rem); margin-bottom: clamp(20px, 4vh, 30px); font-family: 'Playfair Display'; font-style: italic;">"A fragrance is a silent biography, an invisible yet unforgettable signature."</p>
                    <p style="color: var(--text-dim); line-height: 1.8; font-size: clamp(0.95rem, 1.5vw, 1.05rem); margin-bottom: 20px;">Born from a passion for the ancestral art of scent, Luban Fragrance represents the pinnacle of olfactory craftsmanship. We believe that true luxury lies in restraint and purity.</p>
                    <p style="color:var(--text-dim); line-height: 1.8; font-size: clamp(0.95rem, 1.5vw, 1.05rem);">By bypassing the excessive marketing overhead of traditional luxury houses, we invest solely in the soul of the perfume. Each drop tells a story of unparalleled quality, carefully curated from the finest sources globally.</p>
                </div>
            </div>
        </section>

        <section id="contact" style="padding: clamp(60px, 10vh, 120px) var(--container-padding); background: var(--bg-accent);">
            <div class="contact-grid" style="grid-template-columns: 1fr 1fr;">
                <div>
                    <h2 style="font-size: clamp(2rem, 6vw, 4.5rem); color: var(--gold-primary); margin-bottom: clamp(20px, 4vh, 40px); letter-spacing: clamp(3px, 1vw, 5px);">Contact Us</h2>
                    <p style="color: var(--text-dim); margin-bottom: clamp(30px, 5vh, 50px); line-height: 2; font-size: clamp(1rem, 1.5vw, 1.1rem); max-width: 90%;">Should you require guidance in selecting your signature essence or have queries regarding our library, our experts await your message.</p>
                    
                    <div style="display:flex; flex-direction:column; gap:clamp(20px, 4vh, 40px);">
                        <div style="display:flex; align-items:center; gap:clamp(15px, 2vw, 25px);">
                            <div style="width:clamp(50px, 8vw, 60px); height:clamp(50px, 8vw, 60px); border:1px solid var(--border-gold); display:flex; align-items:center; justify-content:center; color:var(--gold-primary); border-radius:50%; background: rgba(203, 163, 92, 0.05); flex-shrink:0;"><i data-lucide="map-pin" size="24"></i></div>
                            <div><p style="text-transform:uppercase; font-size:0.6rem; color:var(--gold-muted); letter-spacing:3px; margin-bottom:5px;">Studio</p><p style="font-size:clamp(0.9rem, 1.2vw, 1rem); font-weight:400;">Dhaka, Bangladesh</p></div>
                        </div>
                        <div style="display:flex; align-items:center; gap:clamp(15px, 2vw, 25px);">
                            <div style="width:clamp(50px, 8vw, 60px); height:clamp(50px, 8vw, 60px); border:1px solid var(--border-gold); display:flex; align-items:center; justify-content:center; color:var(--gold-primary); border-radius:50%; background: rgba(203, 163, 92, 0.05); flex-shrink:0;"><i data-lucide="mail" size="24"></i></div>
                            <div><p style="text-transform:uppercase; font-size:0.6rem; color:var(--gold-muted); letter-spacing:3px; margin-bottom:5px;">Email Address</p><p style="font-size:clamp(0.9rem, 1.2vw, 1rem); font-weight:400; word-break: break-all;">lubanfragrance@gmail.com</p></div>
                        </div>
                    </div>
                </div>
                
                <div class="checkout-panel">
                    <h3 class="playfair" style="font-size: clamp(1.5rem, 3vw, 1.8rem); margin-bottom: 30px; color: var(--gold-primary);">Send an Inquiry</h3>
                    <form onsubmit="event.preventDefault();" style="display: flex; flex-direction: column; gap: 20px;">
                        <input type="text" placeholder="Full Name" class="input interactive" style="border-bottom: 1px solid var(--border-gold); background:transparent;" aria-label="Name" required>
                        <input type="email" placeholder="Email Address" class="input interactive" style="border-bottom: 1px solid var(--border-gold); background:transparent;" aria-label="Email" required>
                        <textarea placeholder="Your message..." rows="4" class="input interactive" style="border-bottom: 1px solid var(--border-gold); background:transparent; resize: none;" aria-label="Message"></textarea>
                        <button type="submit" class="btn-gold interactive" style="width:100%; margin-top:10px;">Send Message</button>
                    </form>
                </div>
            </div>
        </section>
    </div>

    <div id="details-view" style="display: none; min-height: 100vh; padding: clamp(120px, 15vh, 200px) var(--container-padding) clamp(60px, 10vh, 120px);">
        <div id="details-content"></div>
    </div>

    <section id="checkout-view" style="display:none; padding: clamp(100px, 12vh, 160px) var(--container-padding) clamp(60px, 10vh, 120px); background: radial-gradient(circle at 50% -20%, rgba(203, 163, 92, 0.05) 0%, transparent 70%);">
        <div style="max-width:1300px; margin:0 auto;">
            <div style="display:flex; flex-wrap:wrap; justify-content:space-between; align-items:center; margin-bottom:clamp(40px, 8vh, 80px); border-bottom: 1px solid rgba(203, 163, 92, 0.2); padding-bottom: 30px; gap: 20px;">
                <a href="javascript:void(0)" onclick="showView('main')" style="color:var(--gold-primary); font-size:0.7rem; text-transform:uppercase; letter-spacing:4px; display:inline-flex; align-items:center; gap:12px; text-decoration:none; font-weight:600;" class="interactive"><i data-lucide="arrow-left" size="16"></i> Return to Collection</a>
                <div style="text-align: right;">
                    <h2 class="playfair" style="letter-spacing:8px; font-size: clamp(2rem, 5vw, 3.5rem); text-transform: uppercase; margin-bottom: 5px;">Checkout</h2>
                    <p style="font-size:0.65rem; color:var(--gold-muted); text-transform:uppercase; letter-spacing:3px;">Secure Procurement Portal</p>
                </div>
            </div>

            <div class="checkout-grid">
                <aside>
                    <div class="checkout-panel" style="position:sticky; top:calc(var(--nav-height) + 40px); border-color: var(--gold-primary); background: rgba(2, 6, 6, 0.95); backdrop-filter: blur(10px);">
                        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:30px; border-bottom: 1px solid rgba(203, 163, 92, 0.3); padding-bottom: 20px;">
                            <h3 class="playfair" style="font-size: 1.4rem; text-transform: uppercase; letter-spacing: 4px; color: var(--gold-primary);">Order Summary</h3>
                            <span id="checkout-item-count" style="font-size:0.7rem; background:var(--gold-primary); color:var(--bg-dark); padding:2px 8px; border-radius:10px; font-weight:800;">0</span>
                        </div>
                        
                        <div id="checkout-items" style="max-height:clamp(300px, 40vh, 500px); overflow-y:auto; margin-bottom:30px; padding-right: 10px;"></div>

                        <div style="display: flex; flex-direction: column; gap: 15px;">
                            <div class="checkout-summary-line" style="color:var(--text-dim);">
                                <span>Subtotal</span>
                                <span id="checkout-subtotal">0</span>
                            </div>
                            <div class="checkout-summary-line" style="color:var(--text-dim);">
                                <span>Delivery Fee</span>
                                <span id="checkout-shipping">0</span>
                            </div>
                            
                            <div class="checkout-total-line">
                                <div style="display:flex; flex-direction:column;">
                                    <span style="font-size:0.7rem; color:var(--gold-muted); text-transform:uppercase; letter-spacing:3px; margin-bottom:5px;">Total Amount</span>
                                    <span style="font-size:0.6rem; color:rgba(255,255,255,0.3); text-transform:uppercase; letter-spacing:1px;">VAT Inclusive</span>
                                </div>
                                <span id="checkout-total" style="font-size:clamp(1.8rem, 3vw, 2.4rem); font-weight:700; color:var(--gold-primary); letter-spacing:1px;">0</span>
                            </div>
                        </div>

                        <div style="margin-top:30px; padding:20px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.05); border-radius:4px; font-size:0.7rem; line-height:1.6; color:var(--text-dim);">
                            <p><i data-lucide="info" size="12" style="margin-right:8px; vertical-align:middle; color:var(--gold-primary);"></i> Complimentary shipping is applied to all orders exceeding 2,000. Standard logistics fee of 120 for Dhaka and 150 for other regions applies otherwise.</p>
                        </div>
                    </div>
                </aside>

                <div class="checkout-panel" id="checkout-panel">
                    <form id="checkout-form" onsubmit="event.preventDefault(); showOrderConfirmation();" style="display: flex; flex-direction: column; gap: 40px;">
                        <div class="checkout-section-container">
                            <div style="display:flex; align-items:center; gap:20px; margin-bottom:25px;">
                                <div style="width:30px; height:30px; border:1px solid var(--gold-primary); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:0.8rem; color:var(--gold-primary); font-weight:700;">1</div>
                                <h3 style="text-transform:uppercase; letter-spacing:3px; font-size:1.1rem;">Contact Information</h3>
                            </div>

                            <div style="display: flex; flex-direction: column; gap: 30px;">
                            <div class="checkout-input-group">
                                <label>Full Name</label>
                                <input id="billing-name" class="input interactive" type="text" placeholder="Recipient's full name" required>
                            </div>

                            <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 30px;">
                                <div class="checkout-input-group">
                                    <label>Phone Number</label>
                                    <input id="billing-phone" class="input interactive" type="tel" placeholder="01XXXXXXXXX" pattern="[0-9]{11}" title="Please enter a valid 11-digit phone number" required>
                                </div>
                                <div class="checkout-input-group">
                                    <label>Email Address</label>
                                    <input id="billing-email" class="input interactive" type="email" placeholder="your@email.com" required>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="checkout-section-container" style="background: rgba(203, 163, 92, 0.03); border-color: rgba(203, 163, 92, 0.1);">
                        <div style="display:flex; align-items:center; gap:20px; margin-bottom:25px;">
                            <div style="width:30px; height:30px; border:1px solid var(--gold-primary); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:0.8rem; color:var(--gold-primary); font-weight:700;">2</div>
                            <h3 style="text-transform:uppercase; letter-spacing:3px; font-size:1.1rem;">Shipping Address</h3>
                        </div>

                        <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 30px;">
                            <div class="checkout-input-group">
                                <label>District / City</label>
                                <select id="billing-city" class="input interactive" required>
                                    <option value="">Select District</option>
                                        <option value="Dhaka">Dhaka</option>
                                        <option value="Chattogram">Chattogram</option>
                                        <option value="Sylhet">Sylhet</option>
                                        <option value="Rajshahi">Rajshahi</option>
                                        <option value="Khulna">Khulna</option>
                                        <option value="Barishal">Barishal</option>
                                        <option value="Rangpur">Rangpur</option>
                                        <option value="Mymensingh">Mymensingh</option>
                                        <option value="Cumilla">Cumilla</option>
                                        <option value="Gazipur">Gazipur</option>
                                        <option value="Narayanganj">Narayanganj</option>
                                        <option value="Cox's Bazar">Cox's Bazar</option>
                                        <option value="Bogra">Bogra</option>
                                        <option value="Jashore">Jashore</option>
                                        <option value="Dinajpur">Dinajpur</option>
                                        <option value="Narsingdi">Narsingdi</option>
                                        <option value="Tangail">Tangail</option>
                                        <option value="Feni">Feni</option>
                                        <option value="Noakhali">Noakhali</option>
                                        <option value="Pabna">Pabna</option>
                                        <option value="Kushtia">Kushtia</option>
                                        <option value="Naogaon">Naogaon</option>
                                        <option value="Sirajganj">Sirajganj</option>
                                        <option value="Habiganj">Habiganj</option>
                                        <option value="Moulvibazar">Moulvibazar</option>
                                        <option value="Sunamganj">Sunamganj</option>
                                        <option value="Brahmanbaria">Brahmanbaria</option>
                                        <option value="Chandpur">Chandpur</option>
                                        <option value="Lakshmipur">Lakshmipur</option>
                                        <option value="Bhola">Bhola</option>
                                        <option value="Patuakhali">Patuakhali</option>
                                        <option value="Barguna">Barguna</option>
                                        <option value="Jhalokati">Jhalokati</option>
                                        <option value="Pirojpur">Pirojpur</option>
                                        <option value="Gopalganj">Gopalganj</option>
                                        <option value="Madaripur">Madaripur</option>
                                        <option value="Shariatpur">Shariatpur</option>
                                        <option value="Rajbari">Rajbari</option>
                                        <option value="Faridpur">Faridpur</option>
                                        <option value="Manikganj">Manikganj</option>
                                        <option value="Munshiganj">Munshiganj</option>
                                        <option value="Kishoreganj">Kishoreganj</option>
                                        <option value="Netrokona">Netrokona</option>
                                        <option value="Sherpur">Sherpur</option>
                                        <option value="Jamalpur">Jamalpur</option>
                                        <option value="Kurigram">Kurigram</option>
                                        <option value="Lalmonirhat">Lalmonirhat</option>
                                        <option value="Gaibandha">Gaibandha</option>
                                        <option value="Nilphamari">Nilphamari</option>
                                        <option value="Panchagarh">Panchagarh</option>
                                        <option value="Thakurgaon">Thakurgaon</option>
                                        <option value="Joypurhat">Joypurhat</option>
                                        <option value="Natore">Natore</option>
                                        <option value="Chapainawabganj">Chapainawabganj</option>
                                        <option value="Meherpur">Meherpur</option>
                                        <option value="Chuadanga">Chuadanga</option>
                                        <option value="Jhenaidah">Jhenaidah</option>
                                        <option value="Magura">Magura</option>
                                        <option value="Narail">Narail</option>
                                        <option value="Satkhira">Satkhira</option>
                                        <option value="Bagerhat">Bagerhat</option>
                                        <option value="Khagrachhari">Khagrachhari</option>
                                        <option value="Rangamati">Rangamati</option>
                                        <option value="Bandarban">Bandarban</option>
                                    </select>
                                </div>
                                <div class="checkout-input-group">
                                    <label>Full Address</label>
                                    <input id="billing-address" class="input interactive" type="text" placeholder="House, Street, Area details..." required>
                                </div>
                            </div>
                        </div>

                        <div style="display:flex; gap:20px; align-items:center; background: rgba(203, 163, 92, 0.05); padding: 25px; border: 1px dashed var(--gold-primary); border-radius: 4px; margin-top: 10px;">
                            <div style="width:40px; height:40px; background:var(--gold-primary); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--bg-dark); flex-shrink:0;">
                                <i data-lucide="truck" size="20"></i>
                            </div>
                            <div>
                                <h4 style="font-size:0.85rem; font-weight:700; margin-bottom:5px; text-transform:uppercase; letter-spacing:1px;">Cash on Delivery</h4>
                                <p style="font-size:0.75rem; color:var(--gold-muted); opacity:0.8;">Complimentary service active for all regions. Pay upon receiving your selection.</p>
                            </div>
                            <input id="cod-checkbox" type="checkbox" checked disabled style="width:22px; height:22px; accent-color: var(--gold-primary); margin-left:auto;">
                        </div>

                        <button type="submit" class="btn-gold interactive" style="width:100%; padding: 25px; font-weight:700; font-size:0.9rem; letter-spacing:3px; text-transform:uppercase; box-shadow: 0 10px 30px rgba(203, 163, 92, 0.2);">Finalize Procurement</button>
                        
                        <div style="display:flex; justify-content:center; align-items:center; gap:15px; opacity:0.5; font-size:0.65rem; text-transform:uppercase; letter-spacing:2px;">
                            <i data-lucide="shield-check" size="14"></i> End-to-End Encrypted Transaction
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <div id="cart-overlay" onclick="toggleCart(false)">
        <div class="cart-drawer" onclick="event.stopPropagation()">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:50px;">
                <h2 class="playfair" style="font-size: 1.8rem; letter-spacing: 3px;">Selection</h2>
                <button id="cart-close-btn" onclick="toggleCart(false)" style="background:none; border:none; color:var(--text-dim); cursor:pointer;" class="interactive"><i data-lucide="x" size="32"></i></button>
            </div>
            <div id="cart-items" style="flex: 1; overflow-y: auto; margin-bottom: 40px; padding-right: 15px;"></div>
            <div style="border-top: 1px solid var(--border-gold); padding-top: 30px;">
                <div style="display:flex; justify-content:space-between; margin-bottom: 30px;">
                    <span style="text-transform:uppercase; letter-spacing:4px; font-size:0.8rem; color:var(--text-dim);">Total</span>
                    <span id="cart-total" style="font-size:1.8rem; color:var(--gold-primary); font-weight: 700; letter-spacing:1px;">0</span>
                </div>
                <button onclick="checkout()" class="btn-gold interactive" style="width:100%; padding: 22px; font-weight:700;">Proceed to Procurement</button>
            </div>
        </div>
    </div>

    <footer style="padding: clamp(60px, 10vh, 100px) var(--container-padding); text-align:center; border-top:1px solid var(--border-gold); background: var(--bg-dark);">
        <img src="https://i.ibb.co.com/Vcq9NZsL/Logo.png" alt="Luban Logo Footer" style="width: clamp(50px, 10vw, 70px); margin-bottom: clamp(1.5rem, 3vh, 2.5rem); opacity: 0.3; filter: grayscale(1);">
        <div style="display:flex; justify-content:center; gap:clamp(15px, 3vw, 25px); margin-bottom: clamp(25px, 5vh, 35px);">
            <a href="https://www.facebook.com/people/Luban-Fragrance/61586484638332/" target="_blank" rel="noopener noreferrer" style="color:var(--gold-muted);" class="interactive"><i data-lucide="facebook" size="18"></i></a>
            <a href="https://www.instagram.com/lubanfragrance" target="_blank" rel="noopener noreferrer" style="color:var(--gold-muted);" class="interactive"><i data-lucide="instagram" size="18"></i></a>
        </div>
        <p style="font-size: clamp(0.6rem, 1vw, 0.65rem); letter-spacing: clamp(2px, 1vw, 4px); color: var(--gold-muted); text-transform: uppercase;">&copy; 2026 Luban Fragrance. All Rights Reserved.</p>
    </footer>

    <script>
        if (window.lucide) window.addEventListener('load', () => lucide.createIcons());

        const PRICE_3ML_BDT = 200;
        const PRICE_6ML_BDT = 300;
        const APPS_SCRIPT_EXEC_URL = "https://script.google.com/macros/s/AKfycbx-2IooPMPFvx02eF5inEmrQ4G2LKT8HoE0ZjifrJIILT0flmSLHxetFN1vDsFVON31Ig/exec";

        const products = [ { "id": 1, "name": "Ehsas Al Arabia", "price3ml": 200.0, "price6ml": 300.0, "desc": "Oud, Rose, and Amber", "vibe": "Exotic, luxurious, and deeply Middle Eastern.", "img": "https://i.ibb.co.com/qYg6CR3M/ehsas-al-arabia.png", "category": "Oriental", "gender": "Unisex" }, { "id": 2, "name": "Vampire Blood", "price3ml": 200.0, "price6ml": 300.0, "desc": "Red Berries, Jasmine, and Plum", "vibe": "Dark, sweet, and gothic.", "img": "https://i.ibb.co/VpWmC5gv/Red-and-Black-Modern-Black-Friday-Luxury-Fragrance-Perfume-Sale-Instagram-Post.png", "category": "Sweet", "gender": "Unisex" }, { "id": 3, "name": "Creed Aventus", "price3ml": 200.0, "price6ml": 300.0, "desc": "Pineapple, Birch, and Musk", "vibe": "Smoky, fruity, sophisticated.", "img": "https://i.ibb.co/dwwbGFFL/Creed-Aventus.png", "category": "Masculine", "gender": "Masculine" }, { "id": 4, "name": "Baccarat Rouge 540", "price3ml": 200.0, "price6ml": 300.0, "desc": "Saffron, Jasmine, and Amberwood", "vibe": "Airy, burnt-sugar sweetness.", "img": "https://i.ibb.co/5zdJRRc/Baccarat-Rouge-540.png", "category": "Luxury", "gender": "Unisex" }, { "id": 5, "name": "Lattafa Khamrah", "price3ml": 200.0, "price6ml": 300.0, "desc": "Cinnamon, Dates, and Praline", "vibe": "Warm, boozy, and decadently sweet gourmand.", "img": "https://i.ibb.co.com/rfkGptqY/lubanfragrance.png", "category": "Gourmand", "gender": "Unisex" }, { "id": 6, "name": "Lattafa Yara", "price3ml": 200.0, "price6ml": 300.0, "desc": "Heliotrope, Orchid, and Tropical Fruits", "vibe": "Creamy, powdery, and strawberry-marshmallow sweetness.", "img": "https://i.ibb.co.com/HD9xRYg4/Yara.png", "category": "Feminine", "gender": "Feminine" }, { "id": 7, "name": "Stronger With You", "price3ml": 200.0, "price6ml": 300.0, "desc": "Chestnut, Cardamom, and Vanilla", "vibe": "Warm, sweet, and cozythe ultimate date night scent.", "img": "https://i.ibb.co.com/992Qgj3v/Stronger-With-You-canva.png", "category": "Date Night", "gender": "Masculine" }, { "id": 8, "name": "Ariana Grande Cloud", "price3ml": 200.0, "price6ml": 300.0, "desc": "Lavender, Pear, Bergamot, and Whipped Cream", "vibe": "Dreamy, fluffy, and sweetlike a cozy vanilla cloud.", "img": "https://i.ibb.co/tpr16NRQ/Ariana-Grande-Cloud.jpg", "category": "Female", "gender": "Feminine" }, { "id": 10, "name": "YSL Black Opium", "price3ml": 200.0, "price6ml": 300.0, "desc": "Coffee, Vanilla, and White Flowers", "vibe": "Addictive, energizing, and sensual.", "img": "https://i.ibb.co.com/TDz28qGd/Balck-Opium.jpg", "category": "Feminine", "gender": "Feminine" }, { "id": 11, "name": "Good Girl", "price3ml": 200.0, "price6ml": 300.0, "desc": "Tuberose, Jasmine, and Roasted Tonka Bean", "vibe": "A powerful contrast of light and dark florals.", "img": "https://i.ibb.co.com/Fqdtg7jd/Good-Girl.jpg", "category": "Feminine", "gender": "Feminine" }, {
"id": 13,
"name": "Versace Eros",
"price3ml": 200.0,
"price6ml": 300.0,
"desc": "Mint, Candy Apple, and Vanilla",
"vibe": "Loud, sweet, and perfect for a vibrant night out.",
"img": "https://i.ibb.co/Xfzz4vHW/Eros-canva.png",
"category": "Date Night",
"gender": "Masculine"
}, { "id": 15, "name": "Hawas Fire", "price3ml": 200.0, "price6ml": 300.0, "desc": "Pepper, Nutmeg, and Intense Musk", "vibe": "A spicy, fiery evolution of the Hawas DNA.", "img": "https://i.ibb.co.com/V0cfjRpv/Fire.jpg", "category": "Masculine", "gender": "Masculine" }, { "id": 14, "name": "Hawas Ice", "price3ml": 200.0, "price6ml": 300.0, "desc": "Frozen Apple, Bergamot, and Mint", "vibe": "Louder, fresher, and colder than the original DNA.", "img": "https://i.ibb.co.com/RkC0QbCT/Ice.jpg", "category": "Masculine", "gender": "Masculine" }, { "id": 17, "name": "Tobacco Vanille", "price3ml": 200.0, "price6ml": 300.0, "desc": "Tobacco Leaf, Spices, and Creamy Vanilla", "vibe": "Rich, opulent, and smells like a private luxury lounge.", "img": "https://i.ibb.co/XfHdmS75/Tobacco-Vanille-canva.png", "category": "Luxury", "gender": "Unisex" }, { "id": 19, "name": "Miss Dior", "price3ml": 200.0, "price6ml": 300.0, "desc": "Iris, Peony, and Lily-of-the-Valley", "vibe": "Elegant, floral, and romantic.", "img": "https://i.ibb.co.com/C5TwSXbL/Miss.jpg", "category": "Feminine", "gender": "Feminine" }, { "id": 20, "name": "Lady Million", "price3ml": 200.0, "price6ml": 300.0, "desc": "Raspberry, Neroli, and Arabian Jasmine", "vibe": "Vibrant, glamorous, and honey-sweet.", "img": "https://i.ibb.co.com/2YvBKMXH/Lady.jpg", "category": "Feminine", "gender": "Feminine" }, { "id": 21, "name": "Bombshell", "price3ml": 200.0, "price6ml": 300.0, "desc": "Passionfruit, Peony, and Orchid", "vibe": "Bright, fruity, and unapologetically feminine.", "img": "https://i.ibb.co.com/BpCXdrB/Bomb.jpg", "category": "Feminine", "gender": "Feminine" }, { "id": 22, "name": "Acqua Di Gio", "price3ml": 200.0, "price6ml": 300.0, "desc": "Sea Notes, Lime, and Jasmine", "vibe": "The gold standard for aquaticsclean, light, and airy.", "img": "https://i.ibb.co.com/Gf613zdJ/Acqua-canva.png", "category": "Fresh", "gender": "Masculine" }, { "id": 23, "name": "Cool Water Man", "price3ml": 200.0, "price6ml": 300.0, "desc": "Sea Water, Mint, and Lavender", "vibe": "Fresh, aquatic blue classic.", "img": "https://i.ibb.co.com/6RrtfJzJ/Blue-and-White-Modern-Premium-Fragrance-Instagram-Story.jpg", "category": "Classic", "gender": "Unisex" }, { "id": 27, "name": "Sultan", "price3ml": 200.0, "price6ml": 300.0, "desc": "Cedar, Juniper, and Musk", "vibe": "Concentrated woodinessvery masculine and robust.", "img": "https://i.ibb.co.com/1fFTxNF9/sultan.png", "category": "Oriental", "gender": "Unisex" }, { "id": 28, "name": "Paris Hilton (Men)", "price3ml": 200.0, "price6ml": 300.0, "desc": "Cucumber and Mango Profile", "vibe": "A fruity, fresh profile that is casual and easy-going.", "img": "https://i.ibb.co.com/DDspXc3t/Paris-Hilton-Men.png", "category": "Fresh", "gender": "Unisex" } ];

        const CART_STORAGE_KEY = 'luban_cart_v1';
        const RECENTLY_VIEWED_KEY = 'luban_recent_v1';
        const SEARCH_HISTORY_KEY = 'luban_search_history_v1';
        const WISHLIST_STORAGE_KEY = 'luban_wishlist_v1';
        const WISHLIST_QTY_KEY = 'luban_wishlist_qty_v1';
        let cart = [];
        let recentlyViewed = [];
        let searchHistory = [];
        let wishlist = [];
        let wishlistQuantities = {};
        let selectedSize = '3ml';
        let currentFilter = 'All';

        function saveCartToStorage() { localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart)); }
        function loadCartFromStorage() { const raw = localStorage.getItem(CART_STORAGE_KEY); if (raw) cart = JSON.parse(raw); }

        function saveRecentlyViewed() { localStorage.setItem(RECENTLY_VIEWED_KEY, JSON.stringify(recentlyViewed)); }
        function loadRecentlyViewed() { const raw = localStorage.getItem(RECENTLY_VIEWED_KEY); if (raw) recentlyViewed = JSON.parse(raw); }

        function saveSearchHistory() { localStorage.setItem(SEARCH_HISTORY_KEY, JSON.stringify(searchHistory)); }
        function loadSearchHistory() { const raw = localStorage.getItem(SEARCH_HISTORY_KEY); if (raw) searchHistory = JSON.parse(raw); }

        function saveWishlist() { localStorage.setItem(WISHLIST_STORAGE_KEY, JSON.stringify(wishlist)); }
        function loadWishlist() { 
            try {
                const raw = localStorage.getItem(WISHLIST_STORAGE_KEY); 
                if (raw) wishlist = JSON.parse(raw); 
            } catch (e) {
                console.error("Failed to load wishlist", e);
                wishlist = [];
            }
        }

        function saveWishlistQuantities() { localStorage.setItem(WISHLIST_QTY_KEY, JSON.stringify(wishlistQuantities)); }
        function loadWishlistQuantities() {
            try {
                const raw = localStorage.getItem(WISHLIST_QTY_KEY);
                if (raw) wishlistQuantities = JSON.parse(raw);
            } catch (e) {
                wishlistQuantities = {};
            }
        }

        function toggleWishlist(id) {
            const index = wishlist.indexOf(id);
            let message = '';
            let wasAdded = false;
            
            if (index > -1) {
                wishlist.splice(index, 1);
                message = 'Removed from Wishlist';
                wasAdded = false;
                // Cleanup quantity
                delete wishlistQuantities[id];
                saveWishlistQuantities();
            } else {
                wishlist.push(id);
                message = 'Added to Wishlist';
                wasAdded = true;
                // Initialize quantity
                wishlistQuantities[id] = 1;
                saveWishlistQuantities();
            }
            
            saveWishlist();
            updateWishlistCount(true, wasAdded);
            showToast(message);
            
            // Update all heart buttons (Grid AND Detail view)
            const heartBtns = document.querySelectorAll(`button[data-wishlist-id="${id}"]`);
            const isWishlisted = wishlist.includes(id);
            heartBtns.forEach(btn => {
                if (isWishlisted) btn.classList.add('active');
                else btn.classList.remove('active');
                
                // Update tooltip text
                const tooltip = btn.querySelector('.wishlist-tooltip');
                if (tooltip) {
                    tooltip.innerText = isWishlisted ? 'Remove from Wishlist' : 'Add to Wishlist';
                }
                btn.setAttribute('aria-label', isWishlisted ? 'Remove from wishlist' : 'Add to wishlist');
                
                // Remove inline styles to let CSS classes take over
                btn.style.color = '';
                
                const icon = btn.querySelector('svg') || btn.querySelector('i');
                if (icon) {
                    icon.style.fill = '';
                    icon.removeAttribute('fill');
                    
                    // Trigger pop animation
                    icon.classList.remove('animate-pop');
                    void icon.offsetWidth; // Trigger reflow
                    icon.classList.add('animate-pop');
                }
            });

            // If we are in the wishlist view, we need a full re-render to remove the item
            if (currentFilter === 'Wishlist') {
                // Delay re-render to allow animation to play
                setTimeout(() => {
                    renderShop();
                }, 400);
            }
        }

        let wishlistAnimationTimeout;

        function updateWishlistCount(animate = false, wasAdded = true) {
            const count = wishlist.length;
            const mobileCount = document.getElementById('wishlist-count-mobile');
            const desktopCount = document.getElementById('wishlist-count-desktop');
            
            if (mobileCount) mobileCount.innerText = count;

            if (desktopCount) {
                // Clear any pending cleanup to prevent race conditions
                if (wishlistAnimationTimeout) clearTimeout(wishlistAnimationTimeout);

                // If not animating, handle simple visibility
                if (!animate) {
                    if (count === 0) {
                        desktopCount.style.display = 'none';
                        desktopCount.innerHTML = '';
                    } else {
                        desktopCount.style.display = 'flex';
                        desktopCount.innerHTML = `<span class="wishlist-number" style="transform: translateY(0); opacity: 1;">${count}</span>`;
                    }
                    return;
                }
                
                // If animating, ensure it's visible during animation
                desktopCount.style.display = 'flex';

                const direction = wasAdded ? 'up' : 'down';
                
                // Get the current visible number (if any)
                const currentNum = desktopCount.querySelector('.wishlist-number');
                
                // Create new number (ONLY if count > 0)
                let newNum = null;
                if (count > 0) {
                    newNum = document.createElement('span');
                    newNum.className = 'wishlist-number';
                    newNum.innerText = count;
                    newNum.style.transform = direction === 'up' ? 'translateY(100%)' : 'translateY(-100%)';
                    newNum.style.opacity = '0';
                    desktopCount.appendChild(newNum);
                    
                    // Force reflow
                    void newNum.offsetWidth;
                }
                
                // Animate
                requestAnimationFrame(() => {
                    if (newNum) {
                        newNum.style.transform = 'translateY(0)';
                        newNum.style.opacity = '1';
                    }
                    
                    if (currentNum) {
                        currentNum.style.transform = direction === 'up' ? 'translateY(-100%)' : 'translateY(100%)';
                        currentNum.style.opacity = '0';
                    }
                });
                
                // Cleanup
                wishlistAnimationTimeout = setTimeout(() => {
                    if (currentNum && currentNum.parentNode === desktopCount) {
                        desktopCount.removeChild(currentNum);
                    }
                    
                    if (newNum) {
                        // Ensure the new number is firmly in place
                        newNum.style.transform = 'translateY(0)';
                        newNum.style.opacity = '1';
                    }
                    
                    // If count reached 0, hide the badge after animation
                    if (count === 0) {
                        desktopCount.style.display = 'none';
                        desktopCount.innerHTML = '';
                    }
                }, 300);
            }
        }

        function confirmEmptyWishlist() {
            const overlay = document.createElement('div');
            overlay.className = 'confirm-overlay';
            overlay.id = 'empty-wishlist-modal';
            
            // Close on background click
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('show');
                    setTimeout(() => overlay.remove(), 500);
                }
            };

            overlay.innerHTML = `
                <div class="confirm-box">
                    <h3 style="color:var(--gold-primary); text-transform:uppercase; letter-spacing:3px; margin-bottom:20px;">Clear Wishlist?</h3>
                    <p style="color:var(--text-dim); margin-bottom:30px; font-size:0.9rem;">This will remove all items from your saved collection.</p>
                    <div style="display:flex; gap:20px; justify-content:center;">
                        <button onclick="const el = document.getElementById('empty-wishlist-modal'); el.classList.remove('show'); setTimeout(() => el.remove(), 500);" class="filter-btn interactive">Cancel</button>
                        <button onclick="emptyWishlist()" class="btn-gold interactive" style="padding:12px 30px; border-color: #d32f2f; color: #d32f2f;">Clear All</button>
                    </div>
                </div>
            `;
            document.body.appendChild(overlay);
            setTimeout(() => overlay.classList.add('show'), 10);
        }

        function emptyWishlist() {
            wishlist = [];
            saveWishlist();
            updateWishlistCount(true);
            renderShop();
            const modal = document.getElementById('empty-wishlist-modal');
            if(modal) {
                modal.classList.remove('show');
                setTimeout(() => modal.remove(), 500);
            }
            showToast('Wishlist Cleared');
        }

        function showToast(message) {
            const toast = document.getElementById('toast-notification');
            if (toast) {
                toast.querySelector('span').innerText = message;
                toast.classList.add('show');
                if (window.lucide) lucide.createIcons();
                setTimeout(() => toast.classList.remove('show'), 3000);
            }
        }

        function addToSearchHistory(query) {
            if (!query || query.trim() === '') return;
            const q = query.trim().toLowerCase();
            searchHistory = searchHistory.filter(x => x !== q);
            searchHistory.unshift(q);
            if (searchHistory.length > 5) searchHistory.pop();
            saveSearchHistory();
            renderSearchHistory();
        }

        function addToRecentlyViewed(id) {
            recentlyViewed = recentlyViewed.filter(x => x !== id);
            recentlyViewed.unshift(id);
            if (recentlyViewed.length > 8) recentlyViewed.pop();
            saveRecentlyViewed();
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('active');
            if (menu.classList.contains('active')) {
                document.body.classList.add('no-cursor');
                // Reset submenu and search on open
                document.getElementById('collection-submenu').classList.remove('active');
                document.getElementById('submenu-icon').style.transform = 'rotate(0deg)';
                document.getElementById('mobile-search').value = '';
                document.getElementById('search-suggestions').classList.remove('active');
                renderSearchHistory();
                renderMobileRecent();
                updateWishlistCount();
            }
            else document.body.classList.remove('no-cursor');
        }

        function renderMobileRecent() {
            const list = document.getElementById('mobile-recent-list');
            const section = document.getElementById('mobile-recent-section');
            if (!list || !section) return;
            
            if (recentlyViewed.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            const recentProducts = recentlyViewed.map(id => products.find(p => p.id === id)).filter(Boolean);
            
            list.innerHTML = recentProducts.map(p => `
                <div onclick="showView('details', ${p.id}); toggleMobileMenu();" style="flex-shrink:0; width:80px; text-align:center; cursor:pointer;">
                    <div style="width:80px; height:80px; background:var(--bg-accent); border:1px solid var(--border-gold); display:flex; align-items:center; justify-content:center; margin-bottom:8px;">
                        <img src="${p.img}" style="max-width:70%; max-height:70%; object-fit:contain;" onerror="handleImageError(this)">
                    </div>
                    <p style="font-size:0.55rem; text-transform:uppercase; letter-spacing:1px; color:var(--text-dim); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${p.name}</p>
                </div>
            `).join('');
        }

        function showWishlist() {
            currentFilter = 'Wishlist';
            renderShop();
            handleNavClick('shop');
        }

        function handleSearchInput(value) {
            const suggestionsEl = document.getElementById('search-suggestions');
            if (!value || value.length < 2) {
                suggestionsEl.classList.remove('active');
                return;
            }

            const query = value.toLowerCase();
            const suggestions = products
                .filter(p => {
                    // For suggestions, we prioritize name and category
                    const text = `${p.name} ${p.category}`;
                    return fuzzyMatch(text, query);
                })
                .map(p => p.name)
                .slice(0, 5);

            if (suggestions.length > 0) {
                suggestionsEl.innerHTML = suggestions.map(s => `
                    <div class="suggestion-item" onclick="applyRecentSearch('${s}')">${s}</div>
                `).join('');
                suggestionsEl.classList.add('active');
            } else {
                suggestionsEl.classList.remove('active');
            }
        }

        function renderSearchHistory() {
            const container = document.getElementById('search-history-container');
            if (!container) return;
            if (searchHistory.length === 0) {
                container.innerHTML = '';
                return;
            }
            container.innerHTML = searchHistory.map(q => `
                <span onclick="applyRecentSearch('${q}')" class="interactive" style="font-size: 0.65rem; color: var(--gold-muted); border: 1px solid rgba(203, 163, 92, 0.2); padding: 4px 10px; border-radius: 1px; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; transition: var(--transition-fast);">
                    ${q}
                </span>
            `).join('');
        }

        function applyRecentSearch(query) {
            document.getElementById('mobile-search').value = query;
            handleMobileSearch();
        }

        function toggleSubmenu(id) {
            const submenu = document.getElementById(id);
            submenu.classList.toggle('active');
            const icon = document.getElementById('submenu-icon');
            if (icon) {
                icon.style.transform = submenu.classList.contains('active') ? 'rotate(180deg)' : 'rotate(0deg)';
            }
        }

        function handleMobileSearch() {
            const query = document.getElementById('mobile-search').value.toLowerCase();
            if (!query) return;
            
            addToSearchHistory(query);
            currentFilter = 'All'; 
            renderShop(query);
            toggleMobileMenu();
            handleNavClick('shop');
        }

        function handleNavClick(id) {
            showView('main');
            setTimeout(() => {
                const el = document.getElementById(id);
                if (el) {
                    const navHeight = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--nav-height')) || 80;
                    const offset = el.offsetTop - navHeight;
                    window.scrollTo({
                        top: offset,
                        behavior: 'smooth'
                    });
                }
            }, 100);
        }

        /* Generic Error Handling for Images to ensure luxury look even if assets fail */
        function handleImageError(img) {
            img.onerror = null;
            img.src = 'https://i.ibb.co.com/Vcq9NZsL/Logo.png';
            img.style.opacity = '0.08';
            img.style.filter = 'grayscale(1) contrast(1.1)';
            img.style.scale = '0.7';
            // Enhance the parent background with a shimmering luxury radial gradient if it's a shop or detail view
            const container = img.closest('.image-container') || img.parentElement;
            if (container && (container.classList.contains('image-container') || container.style.aspectRatio)) {
                container.style.background = 'radial-gradient(circle at center, rgba(203, 163, 92, 0.15) 0%, rgba(2, 6, 6, 1) 100%)';
            }
        }

        function setFilter(filter) {
            currentFilter = filter;
            updateFilterUI();
            renderShop();
        }

        function updateFilterUI() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.dataset.filter === currentFilter) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function levenshtein(a, b) {
            if (a.length === 0) return b.length;
            if (b.length === 0) return a.length;
            const matrix = [];
            for (let i = 0; i <= b.length; i++) matrix[i] = [i];
            for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    if (b.charAt(i - 1) === a.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            return matrix[b.length][a.length];
        }

        function fuzzyMatch(text, query) {
            const words = text.toLowerCase().split(/\s+/);
            const queryWords = query.toLowerCase().split(/\s+/);
            
            return queryWords.every(qWord => {
                return words.some(word => {
                    if (word.includes(qWord)) return true;
                    if (qWord.length > 3 && word.length > 3) {
                        const dist = levenshtein(word, qWord);
                        return dist <= 2; // Allow 2 edits for words > 3 chars
                    }
                    return false;
                });
            });
        }

        function renderShop(searchQuery = '') {
            const list = document.getElementById('product-list');
            
            // Toggle Wishlist Controls
            const wishlistControls = document.getElementById('wishlist-controls');
            if (wishlistControls) {
                wishlistControls.style.display = (currentFilter === 'Wishlist' && wishlist.length > 0) ? 'flex' : 'none';
            }
            
            // Add filtering class for transition
            list.classList.add('filtering');
            
            // Show skeletons first to simulate loading
            setTimeout(() => {
                list.innerHTML = Array(8).fill(0).map(() => `
                    <div class="skeleton-card">
                        <div class="skeleton skeleton-img"></div>
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div class="skeleton skeleton-title"></div>
                            <div class="skeleton skeleton-price"></div>
                        </div>
                        <div class="skeleton skeleton-text"></div>
                    </div>
                `).join('');
                list.classList.remove('filtering');
            }, 300);

            // Simulate a fetch delay
            setTimeout(() => {
                let filtered;
                if (currentFilter === 'Wishlist') {
                    filtered = products.filter(p => wishlist.includes(p.id));
                } else {
                    filtered = products;
                    if (currentFilter !== 'All') {
                        filtered = filtered.filter(p => p.gender === currentFilter);
                    }
                }
                
                if (searchQuery) {
                    const q = searchQuery.toLowerCase();
                    filtered = filtered.filter(p => {
                        const text = `${p.name} ${p.desc} ${p.category} ${p.vibe} ${p.gender}`;
                        return fuzzyMatch(text, q);
                    });
                }

                if (filtered.length === 0) {
                    list.innerHTML = `
                        <div style="grid-column: 1/-1; text-align:center; padding: clamp(60px, 10vh, 100px) 0; display:flex; flex-direction:column; align-items:center; gap:20px; animation: luxuryFadeIn 0.5s ease;">
                            <div style="width:80px; height:80px; border:1px solid var(--gold-muted); border-radius:50%; display:flex; align-items:center; justify-content:center; color:var(--gold-muted); margin-bottom:10px;">
                                <i data-lucide="search-x" size="32"></i>
                            </div>
                            <h3 style="color:var(--gold-primary); letter-spacing:4px; text-transform:uppercase; font-size:1.2rem;">No Matches Found</h3>
                            <p style="color:var(--text-dim); font-size:0.9rem; max-width:400px; line-height:1.6;">We could not locate any scents matching your query. Try adjusting your search terms or explore our full collection.</p>
                            <button onclick="setFilter('All'); document.getElementById('mobile-search').value=''; renderShop();" class="btn-gold interactive" style="padding:15px 30px; font-size:0.7rem; margin-top:20px;">View Full Collection</button>
                        </div>
                    `;
                    if (window.lucide) lucide.createIcons();
                    return;
                }
                
                if (currentFilter === 'Wishlist') {
                    // Denser Grid for Wishlist
                    list.style.gridTemplateColumns = 'repeat(auto-fill, minmax(180px, 1fr))';
                    list.style.gap = '25px';
                } else {
                    // Standard Grid
                    list.style.gridTemplateColumns = 'repeat(auto-fill, minmax(280px, 1fr))';
                    list.style.gap = 'clamp(20px, 4vw, 40px)';
                }
                
                list.innerHTML = filtered.map(p => {
                    const isWishlisted = wishlist.includes(p.id);
                    let quickAddBtn = '';
                    let qtyControls = '';

                    if (currentFilter === 'Wishlist') {
                        const qty = wishlistQuantities[p.id] || 1;
                        // Compact controls for wishlist
                        const isMinQty = qty <= 1;
                        qtyControls = `
                            <div style="display:flex; align-items:center; justify-content:space-between; margin-top:12px; background:rgba(255,255,255,0.05); padding:6px; border-radius:4px; border: 1px solid var(--border-white);">
                                <button id="wishlist-minus-${p.id}" onclick="event.stopPropagation(); changeWishlistQty(${p.id}, -1)" class="qty-btn interactive ${isMinQty ? 'disabled' : ''}" style="width:28px; height:28px; padding:0; opacity:${isMinQty ? '0.3' : '1'}; pointer-events:${isMinQty ? 'none' : 'auto'};"><i data-lucide="minus" size="14"></i></button>
                                <input type="number" id="wishlist-qty-${p.id}" value="${qty}" readonly
                                    onclick="event.stopPropagation()" 
                                    style="font-size:0.85rem; font-weight:700; width:36px; text-align:center; color:var(--text-white); background:transparent; border:none; -moz-appearance: textfield; padding:0; pointer-events:none;">
                                <button onclick="event.stopPropagation(); changeWishlistQty(${p.id}, 1)" class="qty-btn interactive" style="width:28px; height:28px; padding:0;"><i data-lucide="plus" size="14"></i></button>
                            </div>
                        `;
                        quickAddBtn = `
                            <button id="quick-add-btn-${p.id}" onclick="event.stopPropagation(); addWishlistItemToCart(${p.id});" class="btn-gold interactive" style="width:100%; margin-top:10px; padding:10px; font-size:0.7rem; display:flex; align-items:center; justify-content:center; gap:8px; border-radius:4px; letter-spacing:1px; font-weight:600;">
                                <i data-lucide="shopping-bag" size="14"></i> Add (${qty})
                            </button>
                        `;
                    }
                    
                    return `
                    <div class="product-card interactive" onclick="showView('details', ${p.id})" style="${currentFilter === 'Wishlist' ? 'padding:15px; display:flex; flex-direction:column; height:100%;' : ''}">
                        <button data-wishlist-id="${p.id}" onclick="event.stopPropagation(); toggleWishlist(${p.id})" class="wishlist-btn interactive ${isWishlisted ? 'active' : ''}" aria-label="${isWishlisted ? 'Remove from wishlist' : 'Add to wishlist'}" style="${currentFilter === 'Wishlist' ? 'top:15px; right:15px; width:36px; height:36px;' : ''}">
                            <i data-lucide="heart" size="${currentFilter === 'Wishlist' ? '18' : '24'}"></i>
                            <span class="wishlist-tooltip">${isWishlisted ? 'Remove from Wishlist' : 'Add to Wishlist'}</span>
                        </button>
                        <div class="image-container" style="${currentFilter === 'Wishlist' ? 'height:200px; margin-bottom:15px; background:var(--bg-accent); border-radius:2px;' : ''}">
                            <div class="parallax-wrapper">
                                <img src="${p.img}" alt="${p.name}" loading="lazy" onerror="handleImageError(this)" style="${currentFilter === 'Wishlist' ? 'max-width:85%; max-height:85%;' : ''}">
                            </div>
                        </div>
                        <div class="product-info" style="${currentFilter === 'Wishlist' ? 'padding:0; flex:1; display:flex; flex-direction:column;' : ''}">
                            <div class="product-header" style="${currentFilter === 'Wishlist' ? 'flex-direction:column; align-items:flex-start; gap:4px; margin-bottom:auto;' : ''}">
                                <h3 class="product-name" style="${currentFilter === 'Wishlist' ? 'font-size:0.95rem; line-height:1.3;' : ''}">${p.name}</h3>
                                <span class="product-price" style="${currentFilter === 'Wishlist' ? 'font-size:0.85rem; color:var(--gold-primary); font-weight:600;' : ''}">${PRICE_3ML_BDT}</span>
                            </div>
                            ${currentFilter !== 'Wishlist' ? `<p class="product-desc">${p.desc}</p>` : ''}
                            ${qtyControls}
                            ${quickAddBtn}
                        </div>
                    </div>
                `}).join('');
                if (window.lucide) lucide.createIcons();
            }, 600);
        }

        function showView(view, id) {
            const main = document.getElementById('main-view');
            const detailView = document.getElementById('details-view');
            const checkoutView = document.getElementById('checkout-view');
            const currentView = main.style.display !== 'none' ? 'main' : 
                                detailView.style.display !== 'none' ? 'details' : 
                                checkoutView.style.display !== 'none' ? 'checkout' : '';
            main.style.display = 'none';
            detailView.style.display = 'none';
            checkoutView.style.display = 'none';
            if(view === 'details') {
                const p = products.find(x => x.id === id);
                selectedSize = '3ml'; 
                addToRecentlyViewed(id);
                
                // Show detail skeleton
                document.getElementById('details-content').innerHTML = `
                    <div class="about-grid" style="grid-template-columns: 1fr 1fr; gap: clamp(40px, 8vw, 100px);">
                        <div class="skeleton skeleton-img" style="aspect-ratio:1/1; width:100%;"></div>
                        <div style="display:flex; flex-direction:column; gap:30px;">
                            <div class="skeleton skeleton-title" style="height:60px; width:80%;"></div>
                            <div class="skeleton skeleton-price" style="height:40px; width:40%;"></div>
                            <div class="skeleton skeleton-text" style="height:20px; width:100%;"></div>
                            <div class="skeleton skeleton-text" style="height:20px; width:90%;"></div>
                            <div class="skeleton skeleton-text" style="height:20px; width:95%;"></div>
                            <div class="skeleton" style="height:60px; width:100%; margin-top:20px;"></div>
                        </div>
                    </div>
                `;
                detailView.style.display = 'block';
                
                setTimeout(() => {
                    renderDetails(p);
                }, 500);
            } else if (view === 'checkout') {
                checkoutView.style.display = 'block';
                renderCheckout();
            } else {
                main.style.display = 'block';
            }
            if (currentView !== view && currentView !== '') window.scrollTo({ top: 0, behavior: 'auto' });
        }

        function setSize(size, productId, el) {
            selectedSize = size;
            document.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('active'));
            if (el) el.classList.add('active');
            document.getElementById('detail-price').innerText = `${size === '3ml' ? PRICE_3ML_BDT : PRICE_6ML_BDT}`;
        }

        function renderDetails(p) {
            const isWishlisted = wishlist.includes(p.id);
            document.getElementById('details-content').innerHTML = `
                <div>
                    <div style="background:var(--bg-accent); border:1px solid var(--border-gold); aspect-ratio:1/1; display:flex; align-items:center; justify-content:center; padding:clamp(20px, 8vw, 80px); box-shadow: var(--shadow-medium); position: relative;">
                        <img src="${p.img}" style="max-width:90%; max-height:90%; object-fit:contain; filter: drop-shadow(0 20px 40px rgba(0,0,0,0.6));" onerror="handleImageError(this)">
                        <button data-wishlist-id="${p.id}" onclick="toggleWishlist(${p.id})" class="wishlist-btn interactive ${isWishlisted ? 'active' : ''}" style="top:30px; right:30px; width:50px; height:50px;" aria-label="${isWishlisted ? 'Remove from wishlist' : 'Add to wishlist'}">
                            <i data-lucide="heart" size="24"></i>
                            <span class="wishlist-tooltip">${isWishlisted ? 'Remove from Wishlist' : 'Add to Wishlist'}</span>
                        </button>
                    </div>
                    <div>
                        <span onclick="showView('main')" style="cursor:pointer; color:var(--gold-primary); font-size:0.75rem; text-transform:uppercase; letter-spacing:5px; display:inline-flex; align-items:center; gap:15px; margin-bottom:40px;" class="interactive">
                            <i data-lucide="arrow-left" size="18"></i> Back to library
                        </span>
                        <h2 style="font-size:clamp(2.2rem, 6vw, 4.5rem); margin-bottom:20px; text-transform: uppercase;">${p.name}</h2>
                        <div id="detail-price" style="font-size:clamp(1.8rem, 4vw, 2.5rem); color:var(--gold-primary); font-weight: 700; margin-bottom:40px; letter-spacing:2px;">${PRICE_3ML_BDT}</div>
                        <p style="text-transform:uppercase; font-size:0.7rem; color:var(--gold-muted); letter-spacing:4px; margin-bottom:20px; font-weight:600;">Selection Volume</p>
                        <div style="display:flex; gap:20px; margin-bottom: 50px;">
                            <button class="size-btn active interactive" onclick="setSize('3ml', ${p.id}, this)">3 mL Volume</button>
                            <button class="size-btn interactive" onclick="setSize('6ml', ${p.id}, this)">6 mL Volume</button>
                        </div>
                        <p style="font-style:italic; color:var(--text-dim); margin-bottom:30px; border-left:2px solid var(--gold-primary); padding-left:30px; font-size:clamp(1rem, 3vw, 1.2rem); font-family:'Playfair Display'; opacity:0.8;">"${p.vibe}"</p>
                        <p style="color:var(--text-dim); margin-bottom:50px; line-height: 2; font-size:1.05rem;">Masterfully blended notes of ${p.desc}. Every drop is a testament to quality, curated for those who seek the extraordinary and demand only the finest.</p>
                        <div style="display:flex; gap:20px;">
                            <button class="btn-gold interactive" style="flex:1; padding:25px; font-weight:700;" onclick="addToCart(${p.id})">Add to Selection</button>
                        </div>
                    </div>
                </div>
                
                ${renderRecentlyViewedSection(p.id)}
            `;
            if (window.lucide) lucide.createIcons();
        }

        function renderRecentlyViewedSection(currentId) {
            const recentIds = recentlyViewed.filter(id => id !== currentId);
            if (recentIds.length === 0) return '';
            
            const recentProducts = recentIds.map(id => products.find(p => p.id === id)).filter(Boolean);
            
            return `
                <div style="margin-top: clamp(80px, 15vh, 120px); border-top: 1px solid var(--border-gold); padding-top: 60px;">
                    <h3 class="playfair" style="font-size: clamp(1.5rem, 3vw, 2.2rem); margin-bottom: 40px; color: var(--gold-primary); letter-spacing: 5px; text-transform: uppercase;">Recently Viewed</h3>
                    <div style="display: grid; gap: 30px; grid-template-columns: repeat(auto-fill, minmax(clamp(150px, 15vw, 220px), 1fr));">
                        ${recentProducts.map(rp => `
                            <div class="interactive" onclick="showView('details', ${rp.id})" style="cursor:pointer; background: rgba(255,255,255,0.01); border: 1px solid var(--border-gold); padding: 20px; border-radius: 1px; transition: var(--transition-fast);">
                                <div style="aspect-ratio:1/1; display:flex; align-items:center; justify-content:center; margin-bottom:15px; background: var(--bg-accent); overflow:hidden;">
                                    <img src="${rp.img}" style="max-width:70%; max-height:70%; object-fit:contain; transition: var(--transition-fast);" onerror="handleImageError(this)">
                                </div>
                                <h4 style="font-size:0.8rem; text-transform:uppercase; letter-spacing:2px; margin-bottom:5px; font-weight:400; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${rp.name}</h4>
                                <p style="color:var(--gold-primary); font-weight:700; font-size:0.9rem;">${PRICE_3ML_BDT}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function toggleCart(open) {
            const overlay = document.getElementById('cart-overlay');
            if(open) {
                overlay.classList.add('open');
                document.body.classList.add('no-cursor');
                renderCart();
            } else {
                overlay.classList.remove('open');
                document.body.classList.remove('no-cursor');
            }
        }

        function addToCart(id, qty = 1) {
            const p = products.find(x => x.id === id);
            const currentPrice = selectedSize === '3ml' ? PRICE_3ML_BDT : PRICE_6ML_BDT;
            const cartId = `${id}-${selectedSize}`;
            const exists = cart.find(x => x.cartId === cartId);
            if(exists) exists.qty += qty;
            else cart.push({ ...p, cartId, selectedSize, activePrice: currentPrice, qty: qty });
            updateCartCount();
            saveCartToStorage();
            toggleCart(true);
        }

        function changeWishlistQty(id, delta) {
            const current = wishlistQuantities[id] || 1;
            const newQty = Math.max(1, current + delta);
            wishlistQuantities[id] = newQty;
            saveWishlistQuantities();
            
            const qtyEl = document.getElementById(`wishlist-qty-${id}`);
            if (qtyEl) qtyEl.value = newQty;
            
            // Update minus button state
            const minusBtn = document.getElementById(`wishlist-minus-${id}`);
            if (minusBtn) {
                if (newQty <= 1) {
                    minusBtn.style.opacity = '0.3';
                    minusBtn.style.pointerEvents = 'none';
                    minusBtn.classList.add('disabled');
                } else {
                    minusBtn.style.opacity = '1';
                    minusBtn.style.pointerEvents = 'auto';
                    minusBtn.classList.remove('disabled');
                }
            }
            
            // Animate button click
            const btn = event.currentTarget;
            if (btn && btn.classList.contains('qty-btn')) {
                btn.style.transform = 'scale(0.9)';
                setTimeout(() => {
                    btn.style.transform = 'scale(1)';
                }, 100);
            }
            
            const btnEl = document.getElementById(`quick-add-btn-${id}`);
            if (btnEl) btnEl.innerHTML = `<i data-lucide="shopping-bag" size="14"></i> Add (${newQty})`;
            if (window.lucide) lucide.createIcons();
        }

        function updateWishlistQtyFromInput(id, value) {
            let newQty = parseInt(value);
            if (isNaN(newQty) || newQty < 1) newQty = 1;
            wishlistQuantities[id] = newQty;
            saveWishlistQuantities();
            
            const qtyEl = document.getElementById(`wishlist-qty-${id}`);
            if (qtyEl) qtyEl.value = newQty;
            
            const btnEl = document.getElementById(`quick-add-btn-${id}`);
            if (btnEl) btnEl.innerHTML = `<i data-lucide="shopping-bag" size="14"></i> Add (${newQty})`;
            if (window.lucide) lucide.createIcons();
        }

        function syncWishlistQuantities() {
            // Remove quantities for items not in wishlist
            Object.keys(wishlistQuantities).forEach(key => {
                if (!wishlist.includes(parseInt(key))) {
                    delete wishlistQuantities[key];
                }
            });
            // Ensure all wishlist items have a quantity
            wishlist.forEach(id => {
                if (!wishlistQuantities[id]) wishlistQuantities[id] = 1;
            });
            saveWishlistQuantities();
        }

        function addWishlistItemToCart(id) {
            const qty = wishlistQuantities[id] || 1;
            addToCart(id, qty);
        }

        function changeQty(cartId, delta) {
            const item = cart.find(i => i.cartId === cartId);
            if (!item) return;
            item.qty = Math.max(0, item.qty + delta);
            if (item.qty === 0) cart = cart.filter(i => i.cartId !== cartId);
            saveCartToStorage();
            renderCart();
            updateCartCount();
        }

        function renderCart() {
            const cont = document.getElementById('cart-items');
            
            if (cart.length === 0) {
                cont.innerHTML = `
                    <div style="height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; opacity: 0; animation: luxuryFadeIn 0.5s ease forwards; padding-top: 40px;">
                        <div style="width: 80px; height: 80px; border-radius: 50%; background: rgba(203, 163, 92, 0.05); border: 1px solid var(--border-gold); display: flex; align-items: center; justify-content: center; margin-bottom: 25px;">
                            <i data-lucide="shopping-bag" size="32" style="color: var(--gold-primary); opacity: 0.8;"></i>
                        </div>
                        <h3 style="font-family: 'Playfair Display', serif; font-size: 1.4rem; color: var(--text-white); margin-bottom: 12px; letter-spacing: 1px;">Your Cart is Empty</h3>
                        <p style="color: var(--text-dim); font-size: 0.9rem; max-width: 260px; margin-bottom: 35px; line-height: 1.6;">Discover our exclusive collection of fragrances and find your signature scent.</p>
                        <button onclick="toggleCart(false); showView('main');" class="btn-gold interactive" style="padding: 14px 28px; font-size: 0.75rem; letter-spacing: 2px; width: auto;">
                            EXPLORE COLLECTION
                        </button>
                    </div>
                `;
                document.getElementById('cart-total').innerText = '0';
                if (window.lucide) lucide.createIcons();
                return;
            }

            cont.innerHTML = '';
            let subtotal = 0;
            cart.forEach((item, index) => {
                subtotal += item.activePrice * item.qty;
                const div = document.createElement('div');
                div.className = 'cart-item';
                /* Sequential entrance delay as requested */
                div.style.animationDelay = `${index * 0.08}s`;
                div.innerHTML = `
                    <div style="width:70px; height:70px; background:var(--bg-accent); display:flex; align-items:center; justify-content:center; flex-shrink:0; border:1px solid var(--border-white);">
                        <img src="${item.img}" style="max-width:80%; max-height:80%; object-fit:contain" onerror="handleImageError(this)">
                    </div>
                    <div style="flex:1">
                        <h4 style="font-size:0.95rem; margin-bottom:5px; text-transform:uppercase; letter-spacing:1px; font-weight:400;">${item.name}</h4>
                        <p style="font-size:0.75rem; color:var(--gold-muted); margin-bottom:10px; letter-spacing:1px;">${item.selectedSize} Essence  ${item.activePrice}</p>
                        <div class="qty-controls" style="width:fit-content; padding: 4px 12px; gap: 12px;">
                            <button class="qty-btn interactive" onclick="changeQty('${item.cartId}', -1)"><i data-lucide="minus" size="14"></i></button>
                            <div style="font-weight:700; min-width:15px; text-align:center; font-size: 0.8rem;">${item.qty}</div>
                            <button class="qty-btn interactive" onclick="changeQty('${item.cartId}', 1)"><i data-lucide="plus" size="14"></i></button>
                        </div>
                    </div>
                    <div style="display:flex; flex-direction:column; align-items:flex-end; gap:15px;">
                        <span style="font-weight:700; color:var(--gold-primary); font-size: 0.9rem;">${item.activePrice * item.qty}</span>
                        <i data-lucide="trash-2" size="18" style="cursor:pointer; color:rgba(255,255,255,0.2);" onclick="changeQty('${item.cartId}', -${item.qty})" class="interactive"></i>
                    </div>
                `;
                cont.appendChild(div);
            });
            document.getElementById('cart-total').innerText = `${subtotal}`;
            if (window.lucide) lucide.createIcons();
        }

        function updateCartCount() {
            document.getElementById('cart-count').innerText = cart.reduce((a,b) => a+b.qty, 0);
        }

        function renderCheckout() {
            const itemsEl = document.getElementById('checkout-items');
            const itemCountEl = document.getElementById('checkout-item-count');
            itemsEl.innerHTML = '';
            let subtotal = 0;
            let totalItems = 0;
            
            cart.forEach(item => {
                subtotal += item.activePrice * item.qty;
                totalItems += item.qty;
                const row = document.createElement('div');
                row.className = 'checkout-item-row';
                row.innerHTML = `
                    <div style="width:65px; height:65px; background:var(--bg-accent); display:flex; align-items:center; justify-content:center; border: 1px solid rgba(203, 163, 92, 0.3); flex-shrink: 0; border-radius: 2px; overflow: hidden;">
                        <img src="${item.img}" style="max-width:80%; max-height:80%; object-fit:contain; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.4));" onerror="handleImageError(this)">
                    </div>
                    <div style="flex:1">
                        <div style="font-weight:500; text-transform:uppercase; font-size:0.8rem; letter-spacing:1.5px; margin-bottom:4px; color:var(--text-white);">${item.name}</div>
                        <div style="color:var(--gold-muted); font-size:0.65rem; text-transform:uppercase; letter-spacing:1px;">${item.qty} units  ${item.selectedSize}</div>
                    </div>
                    <div style="font-weight:700; color:var(--gold-primary); font-size:0.9rem; letter-spacing:0.5px;">${item.activePrice * item.qty}</div>
                `;
                itemsEl.appendChild(row);
            });
            
            if (itemCountEl) itemCountEl.innerText = totalItems;
            
            const district = document.getElementById('billing-city').value;
            let shipping = 0;
            if (subtotal > 0 && subtotal < 2000) {
                shipping = (district === 'Dhaka') ? 70 : 120;
            }
            
            document.getElementById('checkout-subtotal').innerText = `${subtotal}`;
            document.getElementById('checkout-shipping').innerText = shipping === 0 ? 'COMPLIMENTARY' : `${shipping}`;
            
            const totalEl = document.getElementById('checkout-total');
            if (totalEl) totalEl.innerText = `${subtotal + shipping}`;
            
            if (window.lucide) lucide.createIcons();
        }

        function checkout() { toggleCart(false); showView('checkout'); }

        function showOrderConfirmation() {
            const name = document.getElementById('billing-name').value;
            const phone = document.getElementById('billing-phone').value;
            const email = document.getElementById('billing-email').value;
            const city = document.getElementById('billing-city').value;
            const address = document.getElementById('billing-address').value;
            const total = document.getElementById('checkout-total').innerText;

            if (!name || !phone || !email || !city || !address) {
                alert("Please complete all required fields.");
                return;
            }

            const overlay = document.createElement('div');
            overlay.className = 'confirm-overlay';
            overlay.id = 'order-confirmation-modal';
            
            let itemsHtml = cart.map(item => `
                <div style="display:flex; justify-content:space-between; margin-bottom:12px; font-size:0.85rem; border-bottom: 1px solid rgba(255,255,255,0.03); padding-bottom: 8px;">
                    <div style="display:flex; flex-direction:column;">
                        <span style="text-transform:uppercase; letter-spacing:1px; font-weight:500;">${item.name}</span>
                        <span style="color:var(--gold-muted); font-size:0.7rem;">${item.qty} units x ${item.selectedSize}</span>
                    </div>
                    <span style="color:var(--gold-primary); font-weight:600;">${item.activePrice * item.qty}</span>
                </div>
            `).join('');

            overlay.innerHTML = `
                <div class="confirm-box" style="text-align: left; max-width: 500px; border: 1px solid var(--gold-primary); background: var(--bg-dark); box-shadow: 0 20px 60px rgba(0,0,0,0.8);">
                    <div style="text-align:center; margin-bottom:30px;">
                        <i data-lucide="package-search" size="40" color="#cba35c" style="margin-bottom:15px;"></i>
                        <h2 class="playfair" style="letter-spacing:5px; color:var(--gold-primary); font-size: 1.6rem; text-transform: uppercase;">Review Selection</h2>
                    </div>
                    
                    <div style="margin-bottom:30px; background: rgba(203, 163, 92, 0.03); padding: 25px; border: 1px solid rgba(203, 163, 92, 0.2); border-radius: 4px;">
                        <h3 style="font-size:0.6rem; color:var(--gold-muted); text-transform:uppercase; letter-spacing:3px; margin-bottom:15px; border-bottom: 1px solid rgba(203, 163, 92, 0.2); padding-bottom: 12px;">Your Selection</h3>
                        <div style="max-height: 180px; overflow-y: auto; padding-right: 10px; margin-bottom: 15px;">
                            ${itemsHtml}
                        </div>
                        <div style="display:flex; justify-content:space-between; font-weight:700; border-top:1px solid var(--gold-primary); padding-top:20px; margin-top: 10px; align-items: baseline;">
                            <span style="letter-spacing: 2px; font-size: 0.75rem; color:var(--text-dim);">TOTAL AMOUNT</span>
                            <span style="color:var(--gold-primary); font-size:1.6rem; letter-spacing:1px;">${total}</span>
                        </div>
                    </div>

                    <div style="margin-bottom:40px; padding: 0 5px;">
                        <h3 style="font-size:0.6rem; color:var(--gold-muted); text-transform:uppercase; letter-spacing:3px; margin-bottom:15px;">Delivery Details</h3>
                        <div style="display:grid; gap: 12px;">
                            <div style="display:flex; align-items:flex-start; gap:12px;">
                                <i data-lucide="user" size="14" style="margin-top:2px; color:var(--gold-muted);"></i>
                                <p style="font-size:0.85rem; line-height:1.4;"><span style="color:var(--gold-muted); text-transform:uppercase; font-size:0.65rem; letter-spacing:1px; display:block; margin-bottom:2px;">Recipient</span> ${name}</p>
                            </div>
                            <div style="display:flex; align-items:flex-start; gap:12px;">
                                <i data-lucide="phone" size="14" style="margin-top:2px; color:var(--gold-muted);"></i>
                                <p style="font-size:0.85rem; line-height:1.4;"><span style="color:var(--gold-muted); text-transform:uppercase; font-size:0.65rem; letter-spacing:1px; display:block; margin-bottom:2px;">Contact</span> ${phone}</p>
                            </div>
                            <div style="display:flex; align-items:flex-start; gap:12px;">
                                <i data-lucide="map-pin" size="14" style="margin-top:2px; color:var(--gold-muted);"></i>
                                <p style="font-size:0.85rem; line-height:1.4;"><span style="color:var(--gold-muted); text-transform:uppercase; font-size:0.65rem; letter-spacing:1px; display:block; margin-bottom:2px;">Destination</span> ${city}, ${address}</p>
                            </div>
                        </div>
                    </div>

                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                        <button onclick="document.getElementById('order-confirmation-modal').remove()" class="filter-btn interactive" style="width:100%; padding:18px; font-size: 0.7rem; letter-spacing:2px;">Modify</button>
                        <button onclick="document.getElementById('order-confirmation-modal').remove(); executeOrder();" class="btn-gold interactive" style="width:100%; padding:18px; font-size:0.7rem; letter-spacing:2px;">Confirm Selection</button>
                    </div>
                </div>
            `;
            document.body.appendChild(overlay);
            setTimeout(() => overlay.classList.add('show'), 10);
            if (window.lucide) lucide.createIcons();
        }

        async function executeOrder() {
            const order = {
                id: 'LB' + Date.now(),
                name: document.getElementById('billing-name').value,
                phone: document.getElementById('billing-phone').value,
                email: document.getElementById('billing-email').value,
                city: document.getElementById('billing-city').value,
                address: document.getElementById('billing-address').value,
                notes: "",
                items: cart,
                total: document.getElementById('checkout-total').innerText
            };
            const overlay = document.createElement('div');
            overlay.className = 'confirm-overlay';
            overlay.innerHTML = `<div class="confirm-box" style="border-radius:1px; border:1px solid var(--gold-primary);"><h2 style="letter-spacing:10px; color:var(--gold-primary);">TRANSMITTING</h2><p style="margin-top:25px; color:var(--text-dim); letter-spacing:3px; text-transform:uppercase; font-size:0.75rem;">Finalizing your olfactory selection...</p></div>`;
            document.body.appendChild(overlay);
            setTimeout(() => overlay.classList.add('show'), 10);
            try {
                await fetch(APPS_SCRIPT_EXEC_URL, { method: "POST", body: JSON.stringify(order) });
            } catch (err) { console.error("Order logging failed", err); }
            setTimeout(() => {
                overlay.querySelector('.confirm-box').innerHTML = `<i data-lucide="check" size="72" color="#cba35c" style="margin-bottom:20px;"></i><h2 style="margin-top:20px; letter-spacing:10px;">SECURED</h2><p style="margin-top:15px; color:var(--gold-muted); text-transform:uppercase; letter-spacing:4px; font-size:0.7rem;">Your order ${order.id} is being prepared.</p>`;
                lucide.createIcons();
                setTimeout(() => {
                    alert(`Thank you ${order.name}. Your selection has been secured and a confirmation will follow.`);
                    cart = [];
                    saveCartToStorage();
                    updateCartCount();
                    showView('main');
                    overlay.remove();
                }, 2500);
            }, 1800);
        }

        window.addEventListener('scroll', () => {
            const scrollY = window.scrollY;
            const progress = (scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
            const scrollProgressEl = document.getElementById('scroll-progress');
            if(scrollProgressEl) scrollProgressEl.style.width = progress + '%';
            const navbar = document.getElementById('navbar');
            if(navbar) navbar.classList.toggle('scrolled', scrollY > 80);
            const backToTop = document.getElementById('back-to-top');
            if(backToTop) backToTop.classList.toggle('visible', scrollY > 600);
            const bgText = document.querySelector('.hero-bg-text');
            if(bgText) bgText.style.transform = `translateX(${scrollY * 0.12}px)`;
        });

        document.addEventListener('mousemove', (e) => {
            const cursor = document.getElementById('custom-cursor');
            if(cursor) {
                cursor.style.left = e.clientX + 'px';
                cursor.style.top = e.clientY + 'px';
            }
        });

        window.addEventListener('DOMContentLoaded', () => {
            loadCartFromStorage();
            loadRecentlyViewed();
            loadSearchHistory();
            loadWishlist();
            loadWishlistQuantities();
            syncWishlistQuantities();
            updateCartCount();
            updateWishlistCount();
            renderShop();

            const districtSelect = document.getElementById('billing-city');
            if (districtSelect) {
                districtSelect.addEventListener('change', renderCheckout);
            }
        });
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
